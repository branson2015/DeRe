var xt=Object.defineProperty,_t=Object.defineProperties;var bt=Object.getOwnPropertyDescriptors;var ct=Object.getOwnPropertySymbols;var wt=Object.prototype.hasOwnProperty,Ct=Object.prototype.propertyIsEnumerable;var ut=(e,t,n)=>t in e?xt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,Ae=(e,t)=>{for(var n in t||(t={}))wt.call(t,n)&&ut(e,n,t[n]);if(ct)for(var n of ct(t))Ct.call(t,n)&&ut(e,n,t[n]);return e},Ue=(e,t)=>_t(e,bt(t));import{r as w,o as et,g as St,w as tt,a as N,c as G,b as dt,d as h,n as ee,m as nt,t as at,e as ot,F as ze,f as We,h as ft,i as Ye,j as H,k as _e,l as Mt,p as kt,q as st,s as Ke,u as Dt,v as Ne,x as Je,y as ht,z as $t,P as It,A as Tt,B as it,C as rt,D as ie,E as Ve,G as Pt,H as Rt,I as Me,J as Ot,K as At,L as Vt,M as Ft,N as Et,O as Lt,Q as Nt,R as Ht,S as Bt,T as jt,U as Ut,V as zt,W as Wt,X as Yt,Y as Xt,Z as Jt,_ as qt,$ as Kt}from"./vendor.ef4d8afa.js";const Gt=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))a(o);new MutationObserver(o=>{for(const l of o)if(l.type==="childList")for(const r of l.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&a(r)}).observe(document,{childList:!0,subtree:!0});function n(o){const l={};return o.integrity&&(l.integrity=o.integrity),o.referrerpolicy&&(l.referrerPolicy=o.referrerpolicy),o.crossorigin==="use-credentials"?l.credentials="include":o.crossorigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function a(o){if(o.ep)return;o.ep=!0;const l=n(o);fetch(o.href,l)}};Gt();var ke=(e,t)=>{const n=e.__vccOpts||e;for(const[a,o]of t)n[a]=o;return n};const Zt={name:"UIBar",components:{},setup(e,t){let n=null;const a=w([]),o=5,l=dt(),r=function(i){let{order:u,interactions:b}=p(i);u=u.filter(k=>b[k].frames.length>1),u=u.filter((k,S)=>{let D=b[k].frames[b[k].frames.length-1];return!u.slice(0,S).some(J=>D==b[J].frames[b[J].frames.length-1])}),u=u.filter(k=>{let S=b[k].frames[b[k].frames.length-1];return!a.value.some(D=>S==D.id)});for(let k=0,S=0;k<u.length&&S<30;++k){let D=b[u[k]];if(D.n>=o){++S;let J=D.targets[D.targets.length-1],he=D.vc;a.value=a.value.concat({id:J.id,content:J.name,target:J,vc:he})}}},p=function(i){let u=i.length,b={};for(let S=0;S<u;++S){let D=[],J="";for(let he=S;he<u;++he){const{id:Z}=i[he],De=i[he].videoCanvas;D.push(Z),J+="-"+String(Z),b[J]==null&&(b[J]={frames:[],n:0,vc:De}),b[J].frames=[...D],b[J].targets=b[J].frames.map(B=>i.find(ue=>ue.id==B).target),b[J].n++}}const k=Object.keys(b);return k.sort((S,D)=>b[S].n>b[D].n||b[S].n==b[D].n&&b[S].frames.length>b[D].frames.length?-1:1),{order:k,interactions:b}};return et(()=>{n=St.GridStack.init({float:!1,cellHeight:"25px",margin:"0.5px",row:1,column:12,minRow:1,resizable:{handles:" "},alwaysShowResizeHandle:/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)}),l.appContext.config.globalProperties.emitter.on("getShortcutItems",()=>a),l.appContext.config.globalProperties.emitter.on("createShortcutItem",i=>a.push(i)),l.appContext.config.globalProperties.emitter.on("runInteractionAnalysis",r)}),tt(a,i=>{n.removeAll(),i.map((u,b)=>Ue(Ae({w:1,h:1},u),{id:b})).forEach(u=>{n.addWidget(u).addEventListener("click",k=>{l.appContext.config.globalProperties.emitter.emit(`changeState-${u.vc}`,u.target.id)})})}),{grid:n,items:a,runInteractionAnalysis:r,confidence:o}}},Qt={id:"ui-bar"},en=h("div",{class:"grid-stack grid-stack-12"},null,-1),tn=[en];function nn(e,t,n,a,o,l){return N(),G("div",Qt,tn)}var an=ke(Zt,[["render",nn]]);const on="0.0.7",sn={mappings:{loomHover:"loomButton"},spatialTransform:{horizontal_buttons_to_dropdown:!0,vertical_buttons_to_dropdown:!0}};var Ie={version:on,mobile:sn};function rn(e,t){return e?pt(t,a=>a.hide!=!0&&a.id!="-1"&&(gt(e,a)||e.deactivateOnTransition!==!0&&ln(t,a,e))||a.important):{}}function gt(e,t){return e&&e.hasOwnProperty("children")?Object.keys(e.children).includes(String(t.id)):!1}function ln(e,t,n){return gt(e[n.parent_id],t)}function pt(e,t){const n={};return Object.keys(e).filter(a=>t(e[a])).forEach(a=>n[a]=e[a]),n}function cn(e){const t=[];return Object.keys(e).forEach(n=>t[n]=e[n]),t}function un(e){const t={};return e.forEach((n,a)=>t[a]=n),t}function dn(e){const t={};return Object.entries(e).forEach(([n,a])=>{t[n]=a}),t}function fn(e,t=void 0){const n={};return Object.keys(e).forEach(a=>{e[a]!==Object(e[a])?n[a]=e[a]:t!==void 0&&(n[a]=t)}),n}function qe(e){if(typeof e=="object"&&e!==null)if(e.constructor===Array){const t=[];return e.forEach(n=>{t.push(qe(n))}),t}else{const t={};return Object.entries(e).forEach(([n,a])=>{t[n]=qe(a)}),t}return e}function hn(e,t){const n=qe(e),a=qe(t);return function o(l,r){let p={};return[...new Set(Object.keys(l).concat(Object.keys(r)))].forEach(i=>{r[i]===null||(r[i]===void 0||Object.keys(r[i]).length==0||l[i]!==Object(l[i])||r[i]!==Object(r[i])?p[i]=r[i]!==void 0?r[i]:l[i]:p[i]=o(l[i],r[i]))}),p}(n,a)}function gn(e,t){const n=[];for(let a=0;a<e.rows;a++)for(let o=0;o<e.cols;o++){const l=Array.from(e.ucharPtr(a,o)).slice(0,3),r=Array.from(t.ucharPtr(a,o));l.map((i,u)=>[i,r[u]]).forEach(i=>n.push(Math.abs(i[1]-i[0])))}return n}function pn(e,t){return e.map(n=>({x:n.x*t.x,y:n.y*t.y}))}function mn(e){let t="";t+=`M ${e[0].x} ${e[0].y} `;for(let n=1;n<e.length;++n)t+=`L ${e[n].x} ${e[n].y} `;return t+=`L ${e[0].x} ${e[0].y} `,new Path2D(t)}function vn(e,t,n){t===void 0&&(t=Math.min(...e.map(o=>o.x))),n===void 0&&(n=Math.min(...e.map(o=>o.y)));let a="";return e.forEach((o,l)=>{a+=(o.x-t).toPrecision(4)+","+(o.y-n).toPrecision(4),l!==e.length-1&&(a+=" ")}),a}function yn(e){return[{x:e.x,y:e.y},{x:e.x+e.width,y:e.y},{x:e.x+e.width,y:e.y+e.height},{x:e.x,y:e.y+e.height}]}function xn(e){let t=1/0,n=0,a=1/0,o=0;return e.forEach(l=>{t=Math.min(t,l.x),n=Math.max(n,l.x),a=Math.min(a,l.y),o=Math.max(o,l.y)}),{xmin:t,xmax:n,ymin:a,ymax:o}}function _n(e,t,n){return Math.min(Math.max(t,e),n)}function bn(e,t){return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))}function wn(e){return new Promise(t=>setTimeout(t,e))}function Cn(e,t,n=0){let a={};return function(){a[n]||(e.apply(this,arguments),a[n]=!0,setTimeout(function(){delete a[n]},t))}}function Sn(e,t,n){const o=document.elementsFromPoint(t,n).find(p=>p.nodeName=="polygon");if(o===void 0)return null;if(o.isPointInFill){const p=o.getBoundingClientRect(),i=o.parentElement.createSVGPoint();if(i.x=t-p.left,i.y=n-p.top,!o.isPointInFill(i))return null}const l=o.parentElement.parentElement.id,r=e.activeComponents.value[l];return r===void 0||!r.isLoomComponent?null:r}var P={currentTargets:rn,objectFilter:pt,arrayToObject:un,ObjectToArray:cn,shallowCopy:dn,shallowCopyPrimitivesOnly:fn,deepCopy:qe,deepMerge:hn,absdiff:gn,scalePolygon:pn,polyToPath2D:mn,polyToPolyString:vn,rectToPoly:yn,boundingBox:xn,bound:_n,dist:bn,sleep:wn,throttle:Cn,getComponentFromPoint:Sn};function Mn(e,t){if(t.children===void 0)return[];let n=Object.keys(t.children).map(p=>e[p]).filter(p=>Object.keys(p.shape.points).length==4).map(p=>[p]);n.forEach((p,i)=>p[0].group=i);const a=5,o=20,l=5,r=5;for(let p=1;p<n.length;++p)for(let i=0;i<p;++i){const u=n[i].length;for(let b=0;b<u;++b){const k=n[p][0],S=n[i][b];if(!(!k||!S)&&(Ie.mobile&&Ie.mobile.spatialTransform&&Ie.mobile.spatialTransform.horizontal_buttons_to_dropdown&&Math.abs(k.shape.dimensions.centerY-S.shape.dimensions.centerY)<=a&&Math.abs(k.shape.dimensions.min_x-S.shape.dimensions.max_x)<=o||Ie.mobile&&Ie.mobile.spatialTransform&&Ie.mobile.spatialTransform.vertical_buttons_to_dropdown&&Math.abs(k.shape.dimensions.min_y-S.shape.dimensions.max_y)<=r&&Math.abs(k.shape.dimensions.centerX-S.shape.dimensions.centerY<=l))){const D=k.group;n[D].forEach(J=>J.group=i),n[i]=n[i].concat(n[D]),n[D]=[]}}}return n=n.filter(p=>p.length>1),n}function kn(e){const t=(e.max_x-e.min_x)/2,n=Math.max(Math.ceil(Math.pow(t,2/3)),5),a=[];for(let l=0;l<n;++l){const r=2*Math.PI*l/n;a.push({x:Math.sin(r)*t+e.min_x+(e.max_x-e.min_x)/2,y:Math.cos(r)*t+e.min_y+(e.max_y-e.min_y)/2})}const o=Ue(Ae({},e),{min_y:e.centerY-t,max_y:e.centerY+t});return[a,o]}function Dn(e,t,n){Mn(e,e[n]).forEach(o=>{let l=1/0,r=0,p=1/0,i=0;const u=o.map(()=>({}));for(const D in u)u[D]={},l=Math.min(o[D].shape.dimensions.min_x,l),r=Math.max(o[D].shape.dimensions.max_x,r),p=Math.min(o[D].shape.dimensions.min_y,p),i=Math.max(o[D].shape.dimensions.max_y,i);const b=Object.values(o).map(D=>D.id),k=b.join(),S={actor:"dropdown",type:"linear",name:o.map(D=>D.name).join("-"),id:k,parent:e[n].name||"root",parent_id:e[n].id!==void 0?e[n].id:"-1",children:u,frame_no:-1,child_visit_counter:Object.keys(u).length,shape:{type:"poly",points:{0:{x:l,y:p},1:{x:r,y:p},2:{x:r,y:i},3:{x:l,y:i}},dimensions:{min_x:l,max_x:r,min_y:p,max_y:i}}};b.forEach(D=>t[D]={hide:!0,parent_id:S.id,parent:S.name}),t[k]=S})}function $n(e,t,n){["button","hover"].includes(e[n].actor)&&e[n].shape.points.length==4&&([points,dimensions]=kn(e[n].shape.dimensions),t[n].shape={points,dimensions})}function In(e,t){const n=[];for(n.push("-1");n.length;){const a=n.shift();t[a]!==null&&(Dn(e,t,a),$n(e,t,a),e[a].hasOwnProperty("children")&&t[a]!==null&&n.push(...Object.keys(e[a].children)))}}function Tn(e){const t={mode:"mobile"};return In(P.shallowCopy(e),t),t}function Pn(e,t,n){if(n==e.info.mode)return{};let a={};switch(n){case"mobile":a.info={mode:"mobile"},a.data=Tn(t);break}return a}const Ge={props:["parent","vcTargetData","targetData","showHint","interactable","current_state","targets"],emits:["changeState","addHistory"],name:"loomComponent",data:function(){return{isLoomComponent:!0,points:null,eventData:{}}},computed:{renderMode(){return this.$parent.renderMode},instanceID(){return this.$parent.instanceID},page(){return this.$parent.page},vcid(){return this.$parent.id},id(){return this.targetData.id},scale(){return this.vcTargetData.scale||{x:1,y:1}},frame(){return this.targetData.frame_no+1},componentID(){return`${this.instanceID}-${this.page}-${this.vcid}-${this.id}`},calcHintStyle(){return{fill:"rgba(246, 230, 80, 0.7)",stroke:"rgba(250, 240, 80, 0.8)","stroke-width":"2"}},calcStyle(){const e=this.targetData;let t="";const n=P.ObjectToArray(e.shape.points),a=P.scalePolygon(n,this.scale),o=e.shape.dimensions.min_x*this.scale.x,l=e.shape.dimensions.min_y*this.scale.y,r=e.shape.dimensions.max_x*this.scale.x,p=e.shape.dimensions.max_y*this.scale.y,i=a.length;return a.forEach((b,k)=>{t+=`${b.x-o},${b.y-l}`,k!==i-1&&(t+=" ")}),this.points=t,{position:"absolute",top:`${parseInt(l)}px`,left:`${parseInt(o)}px`,width:`${parseInt(r-o)}px`,height:`${parseInt(p-l)}px`}}},mounted(){this.$refs.target&&(this.$refs.target.style.display=this.interactable?"block":"none"),this.emitter.emit("addComponent",[this.componentID,this])},beforeUnmount(){this.emitter.emit("removeComponent",this.componentID)},watch:{interactable:function(e){this.$refs.target&&(this.$refs.target.style.display=e?"block":"none")}}};const Rn={name:"loomBrushingBox",mixins:[Ge],data:function(){return{brushing:{state:!1,start_x:0,start_y:0,end_x:0,end_y:0}}},computed:{brushingBoxStyle:function(){return{position:"absolute",visibility:this.brushing.state?"visible":"hidden",top:this.brushing.start_y+"px",left:this.brushing.start_x+"px",width:this.brushing.end_x-this.brushing.start_x+"px",height:this.brushing.end_y-this.brushing.start_y+"px"}}},mounted:function(){this.eventData.mousedown=function(e){let t=e.currentTarget;var n=$(t).offset(),a=e.pageX-n.left,o=e.pageY-n.top;this.brushing.state=!0,this.brushing.start_x=this.brushing.end_x=a,this.brushing.start_y=this.brushing.end_y=o,this.$emit("addHistory",this.targetData,e)}.bind(this),this.eventData.mouseup=function(e){this.brushing.state=!1}.bind(this),this.eventData.mousemove=function(e){if(this.brushing.state==!1)return;const t=e.currentTarget,n=$(t).offset(),a=this.targetData.shape.dimensions.max_x-this.targetData.shape.dimensions.min_x,o=this.targetData.shape.dimensions.max_y-this.targetData.shape.dimensions.min_y;this.brushing.end_x=e.pageX-n.left,this.brushing.end_y=e.pageY-n.top;const l=6,r=a/l,p=o/l,i=Math.round(this.brushing.start_x/r),u=Math.round(this.brushing.start_y/p),b=Math.round((this.brushing.end_x-this.brushing.start_x)/r),S=(Math.round((this.brushing.end_y-this.brushing.start_y)/p)-1)*l**0+b*l**1+u*l**2+i*l**3;this.$emit("changeState",this.targetData.id,S)}.bind(this)}},On=["id"],An=["width","height"],Vn=["points"];function Fn(e,t,n,a,o,l){return N(),G("div",{ref:"target",id:e.componentID,style:ee(e.calcStyle)},[e.targetData.shape.type=="poly"?(N(),G("svg",{key:0,width:e.calcStyle.width,height:e.calcStyle.height,style:ee([{fill:"transparent","stroke-width":"5"},e.showHint?e.calcHintStyle:{}])},[h("polygon",nt({ref:"polygon"},at(e.eventData),{points:e.points,style:{cursor:"cell"}}),null,16,Vn)],12,An)):ot("",!0),h("div",{id:"brushing-box",ref:"brushing-box",style:ee(l.brushingBoxStyle)},null,4)],12,On)}var En=ke(Rn,[["render",Fn],["__scopeId","data-v-4c0b568f"]]);const Ln={name:"loomButton",mixins:[Ge],mounted:function(){this.eventData.click=function(e){this.$emit("changeState",this.targetData.id),this.$emit("addHistory",this.targetData,e)}.bind(this)}},Nn=["id"],Hn=["width","height"],Bn=["points"];function jn(e,t,n,a,o,l){return N(),G("div",{ref:"target",id:e.componentID,style:ee(e.calcStyle)},[e.targetData.shape.type=="poly"?(N(),G("svg",{key:0,width:e.calcStyle.width,height:e.calcStyle.height,style:ee([{fill:"transparent","stroke-width":"5"},e.showHint?e.calcHintStyle:{}])},[h("polygon",nt({ref:"polygon"},at(e.eventData),{points:e.points,style:{cursor:"pointer"}}),null,16,Bn)],12,Hn)):ot("",!0)],12,Nn)}var Un=ke(Ln,[["render",jn]]);const zn={name:"loomHover",mixins:[Ge],emits:["onmouseleave"],mounted:function(){this.eventData.mouseover=function(e){this.$emit("changeState",this.targetData.id),this.$emit("addHistory",this.targetData,e)}.bind(this),this.eventData.mouseleave=function(e){this.$emit("onmouseleave")}.bind(this)}},Wn=["id"],Yn=["width","height"],Xn=["points"];function Jn(e,t,n,a,o,l){return N(),G("div",{ref:"target",id:e.componentID,style:ee(e.calcStyle)},[e.targetData.shape.type=="poly"?(N(),G("svg",{key:0,width:e.calcStyle.width,height:e.calcStyle.height,style:ee([{fill:"transparent","stroke-width":"5"},e.showHint?e.calcHintStyle:{}])},[h("polygon",nt({ref:"polygon"},at(e.eventData),{points:e.points,style:{cursor:"pointer"}}),null,16,Xn)],12,Yn)):ot("",!0)],12,Wn)}var qn=ke(zn,[["render",Jn]]);const Kn={name:"loomDropdown",mixins:[Ge],methods:{onChange(e){const t=this.targets[Object.keys(this.targetData.children)[e.target.selectedIndex]];this.$emit("changeState",t.id),this.$emit("addHistory",t,e)}},mounted(){this.$nextTick(()=>{this.$refs.dropdown.value=this.$parent.current_state.name})}},Gn=["id"];function Zn(e,t,n,a,o,l){return N(),G("select",{ref:"dropdown",id:e.componentID,style:ee(e.calcStyle),onChange:t[0]||(t[0]=(...r)=>l.onChange&&l.onChange(...r))},[(N(!0),G(ze,null,We(Object.keys(e.targetData.children),r=>(N(),G("option",{key:r},ft(e.targets[r].name),1))),128))],44,Gn)}var Qn=ke(Kn,[["render",Zn]]);const ea={name:"USAMap",props:["targetData","vcTargetData"],inject:["manager"],computed:{width(){return this.$parent.targetData.width*this.scale.x},height(){return this.$parent.targetData.height*this.scale.y},scale(){return this.vcTargetData.scale||{x:1,y:1}},calcStyle(){return{position:"absolute",top:"0px",left:"0px",width:`${this.width}px`,height:`${this.height}px`,backgroundColor:"rgba(0,0,0,0.2)",backgroundImage:`url(assets/USA_${this.projectionType}.png)`,backgroundSize:`${this.width}px ${this.height}px`}},stateCenters(){return this.stateCentersTypes[this.projectionType]}},data:function(){return{projectionTypes:["mercator","lambert"],projectionType:null,stateCentersTypes:{mercator:{WA:{x:.084,y:.097},ID:{x:.183,y:.266},MT:{x:.267,y:.115},ND:{x:.425,y:.095},MN:{x:.527,y:.145},MI:{x:.691,y:.27},ME:{x:.958,y:.192},OR:{x:.077,y:.261},WY:{x:.304,y:.286},SD:{x:.427,y:.229},WI:{x:.602,y:.22},NY:{x:.856,y:.295},VT:{x:.895,y:.25},NH:{x:.915,y:.275},MA:{x:.917,y:.314},CT:{x:.892,y:.353},RI:{x:.914,y:.353},CA:{x:.09,y:.526},NV:{x:.142,y:.427},UT:{x:.23,y:.439},CO:{x:.334,y:.457},NE:{x:.431,y:.354},IA:{x:.542,y:.33},IL:{x:.616,y:.411},IN:{x:.664,y:.414},OH:{x:.722,y:.402},PA:{x:.811,y:.384},NJ:{x:.862,y:.425},KS:{x:.455,y:.473},MO:{x:.557,y:.478},KY:{x:.685,y:.511},WV:{x:.762,y:.464},MD:{x:.847,y:.476},DE:{x:.858,y:.455},VA:{x:.801,y:.51},AZ:{x:.23,y:.633},NM:{x:.327,y:.628},TX:{x:.451,y:.743},OK:{x:.477,y:.589},AR:{x:.56,y:.614},TN:{x:.664,y:.578},NC:{x:.785,y:.58},LA:{x:.556,y:.727},MS:{x:.606,y:.69},AL:{x:.657,y:.691},GA:{x:.715,y:.691},SC:{x:.761,y:.651},FL:{x:.741,y:.848}},lambert:{WA:{x:.221,y:.079},ID:{x:.29,y:.241},MT:{x:.377,y:.141},ND:{x:.502,y:.147},MN:{x:.589,y:.203},MI:{x:.742,y:.285},ME:{x:.961,y:.132},OR:{x:.195,y:.203},WY:{x:.391,y:.303},SD:{x:.503,y:.262},WI:{x:.663,y:.253},NY:{x:.891,y:.25},VT:{x:.918,y:.206},NH:{x:.939,y:.212},MA:{x:.939,y:.253},CT:{x:.931,y:.285},RI:{x:.949,y:.282},CA:{x:.173,y:.453},NV:{x:.237,y:.385},UT:{x:.315,y:.429},CO:{x:.412,y:.462},NE:{x:.512,y:.376},IA:{x:.609,y:.359},IL:{x:.675,y:.421},IN:{x:.727,y:.415},OH:{x:.781,y:.391},PA:{x:.859,y:.341},NJ:{x:.914,y:.356},KS:{x:.529,y:.494},MO:{x:.633,y:.503},KY:{x:.747,y:.503},WV:{x:.815,y:.45},MD:{x:.88,y:.397},DE:{x:.901,y:.406},VA:{x:.854,y:.485},AZ:{x:.296,y:.612},NM:{x:.391,y:.629},TX:{x:.508,y:.756},OK:{x:.549,y:.603},AR:{x:.63,y:.629},TN:{x:.734,y:.574},NC:{x:.854,y:.556},LA:{x:.633,y:.768},MS:{x:.68,y:.697},AL:{x:.731,y:.688},GA:{x:.793,y:.691},SC:{x:.835,y:.626},FL:{x:.84,y:.844},AL:{x:.175,y:.821},HI:{x:.414,y:.974}}}}},methods:{getRelativeStateCenters(){const e=this.$refs.target.getBoundingClientRect();return Object.fromEntries(Object.entries(this.stateCenters).map(([t,n])=>[t,{x:n.x*this.width+e.x,y:n.y*this.height+e.y}]))},async getMapping(){return this.manager.regionSelect.value=!1,await this.$nextTick(()=>{const e=Object.fromEntries(Object.entries(this.getRelativeStateCenters()).map(([t,n])=>{const a=P.getComponentFromPoint(this.manager,...Object.values(n));return a===null?null:[t,{mode:a.renderMode,instance:a.instanceID,page:a.page,vcid:a.vcid,frame:a.frame}]}).filter(t=>t!=null));return this.manager.regionSelect.value=!0,e})}},mounted:function(){this.projectionType="lambert"}};function ta(e,t,n,a,o,l){return N(),G("div",{ref:"target",style:ee(l.calcStyle),onClick:t[0]||(t[0]=(...r)=>e.onclick&&e.onclick(...r))},null,4)}var na=ke(ea,[["render",ta]]);const aa={name:"loomVideoCanvas",emits:["frame_processed"],props:["regionSelect","overlay","renderMode","renderAppMode","dragMode","info","targets","targetData","instanceID","start_state_id"],components:{loomButton:Un,loomHover:qn,loomDropdown:Qn,loomBrushingBox:En,loomUSA:na},setup(e,t){const n=Ye("manager"),a=dt(),o=Ye("emitter"),{loomVideoCanvasRefs:l}=Ye(`instance-${e.instanceID}`),r=n.appRefs[e.instanceID],p=w(100),i=w({x:1,y:1}),u=w(null),b=w(null),k=H(()=>l[S.value]),S=H(()=>e.targetData.id),D=H(()=>e.targetData.page),J=H(()=>e.renderAppMode),he=H(()=>e.instanceID),Z=H(()=>e.targetData.width||e.info.window.width),De=H(()=>Z*i.x),B=H(()=>e.targetData.height||e.info.window.height),ue=H(()=>B*i.y),Fe=H(()=>e.targetData.top||0),He=H(()=>e.targetData.left||0),ge=H(()=>l[e.targetData.parentCanvas]||!1),be=_e({}),Te=w(-1),we=w(!1),Ce=w(!1),U=H(()=>be[z.value]),me=H(()=>P.scalePolygon(U.value,i.value)),Ee=H(()=>P.polyToPolyString(U.value,0,0)),Xe=H(()=>P.polyToPolyString(me.value,0,0)),z=H(()=>{for(let s=xe.value;s&&s.parent_id!=s.id;s=e.targets[s.parent_id])if(be[s.id])return s.id;return-1}),Se=()=>{const s={x:O.value.x-Le.value.x,y:O.value.y-Le.value.y},y=i.value;i.value={x:(i.value.x*Z.value+s.x)/Z.value,y:(i.value.y*B.value+s.y)/B.value};const I={x:y.x-i.value.x,y:y.y-i.value.y};e.targetData.scale=i.value;const m=P.boundingBox(U.value);e.targetData.left+=I.x*m.xmin,e.targetData.top+=I.y*m.ymin,ae()},ve=s=>{const y=10,I=Te.value,m=U.value.length,Y=(I+1)%m,T=((I-1)%m+m)%m;if(P.dist(U.value[I],U.value[Y])<y||P.dist(U.value[I],U.value[T])<y){U.value.splice(I,1),we.value=!1,ae();return}s.x=P.bound(s.x,0,Z.value*i.value.x),s.y=P.bound(s.y,0,B.value*i.value.y),U.value[I]={x:s.x/i.value.x,y:s.y/i.value.y};const X=ge.value;if(!X){ae();return}const Q=X.targetData.cutouts,R=Q.findIndex(oe=>oe.id==e.targetData.id);if(R>=0){const oe=Q[R];oe.poly=U.value,Q.splice(R,1,oe)}ae()},de=(s,y)=>{U.value.splice(s+1,0,{x:y.x/i.value.x,y:y.y/i.value.y}),we.value=!0,Te.value=s+1,ae()},Pe=s=>{if(!e.regionSelect)return-1;const y=2,m=Math.ceil(8/2+y/2);return me.value.map(T=>{let X=0,Q=0;m>T.x?X=-(T.x-m):De.value<T.x+m&&(X=De.value-(T.x+m)),m>T.y?Q=-(T.y-m):ue.value<T.y+m&&(Q=ue.value-(T.y+m));const R=[{x:T.x+X-m,y:T.y+Q-m},{x:T.x+X+m,y:T.y+Q-m},{x:T.x+X+m,y:T.y+Q+m},{x:T.x+X-m,y:T.y+Q+m}];return P.polyToPath2D(R)}).findIndex(T=>ne.value.isPointInPath(T,s.x,s.y))},ye=s=>e.regionSelect?me.value.map((I,m,Y)=>{const T=(m+1)%Y.length,X=Y[T];return P.polyToPath2D([I,X])}).findIndex(I=>ne.value.isPointInStroke(I,s.x,s.y)):-1,q=(s,y)=>{const I="#ff0000",m=2,Y=8;s.lineWidth=m,s.strokeStyle=I;let T=function(X,Q){const R=Math.ceil(Y/2+m/2);s.strokeRect(P.bound(X,R,Z.value-R)-R,P.bound(Q,R,B.value-R)-R,Y,Y)}.bind(k.value);s.beginPath(),s.moveTo(P.bound(y[0].x,m/2,Z.value-m/2),P.bound(y[0].y,m/2,B.value-m/2));for(let X=1;X<y.length;++X)s.lineTo(P.bound(y[X].x,m/2,Z.value-m/2),P.bound(y[X].y,m/2,B.value-m/2));s.closePath(),s.stroke(),y.forEach(X=>T(X.x,X.y))},V=w({x:0,y:0}),E=w({x:0,y:0}),Le=w({x:0,y:0}),O=w({x:0,y:0}),$e=w(!1),Re=w(!1),{dragMode:pe}=Mt(e),c=H(()=>{const s=Math.min(V.value.y,E.value.y)+"px",y=Math.min(V.value.x,E.value.x)+"px",I=Math.abs(E.value.x-V.value.x)+"px",m=Math.abs(E.value.y-V.value.y)+"px";return{position:"absolute",display:re.value?"block":"none","background-color":"rgba(0, 0, 0, 0.5)","border-style":"dashed","pointer-events":"none",top:s,left:y,width:I,height:m}});tt(pe,s=>{ae()});const g=s=>{const{left:y,top:I}=u.value.getBoundingClientRect();return{x:s.clientX-y-e.targetData.left,y:s.clientY-I-e.targetData.top}},v=s=>{if(Le.value=O.value,O.value=g(s),we.value){ve(O.value);return}else if(Ce.value&&e.targetData.resizeable!==!1){Se();return}else(!pe.value&&e.targetData.reshapeable!==!1||e.targetData.resizeable!==!1)&&(Pe(O.value)>=0?document.body.style.cursor="move":ye(O.value)>=0&&(document.body.style.cursor="crosshair"));!$e.value||!Re.value||e.targetData.movable!==!1&&(E.value=O.value,pe.value&&(e.targetData.top+=s.movementY,e.targetData.left+=s.movementX))},M=s=>{const y=g(s),I=s.shiftKey;if(e.targetData.reshapeable!==!1||e.targetData.resizeable!==!1){const m=Pe(y);if(m>=0&&!pe.value&&(I&&e.targetData.resizeable!==!1?Ce.value=!0:e.targetData.reshapeable!==!1&&(Ce.value=!1,we.value=!0,Te.value=m)),m<0&&e.targetData.reshapeable!==!1){const Y=ye(y);Y>=0&&(de(Y,y),ae())}}},x=s=>(document.body.style.cursor="default",$e.value=!0,O.value=g(s),pe.value?E.value=V.value={x:-1e4,y:-1e4}:E.value=V.value=O.value,o.emit("deselect"),$e.value=!0,o.emit("selectVideoCanvas",k.value),Re.value=e.regionSelect,!1),C=s=>{Re.value=!1,$e.value=!1,Ce.value=!1,we.value=!1,document.body.style.cursor="default"},L=()=>{Re.value=!1,V.value=E.value={x:-1e4,y:-1e4}},A=()=>{$e.value=!1},re=H(()=>!(pe.value||!e.regionSelect||V.value.x==-1e4||V.value.y==-1e4||E.value.x==-1e4||E.value.y==-1e4||Math.abs(E.value.x-V.value.x)<5||Math.abs(E.value.y-V.value.y)<5));tt(re,s=>{o.emit("regionExists",{exists:s,origin:k.value})});const Oe=()=>{V.value.x>E.value.x&&([V.value.x,E.value.x]=[E.value.x,V.value.x]),V.value.y>E.value.y&&([V.value.y,E.value.y]=[E.value.y,V.value.y]),se(P.rectToPoly({x:V.value.x,y:V.value.y,width:E.value.x-V.value.x,height:E.value.y-V.value.y})),V.value=E.value={x:-1e4,y:-1e4}},te=(s,y=!0)=>{se(s,!1,y)},se=(s,y=!0,I=!0)=>{if(s.length>0&&!e.targetData.parentCanvas){r.newVideoTarget({parentCanvas:e.targetData.id,startupFn:m=>{m.cutRegions(s,y,I),m.emitter.emit("deselect"),delete m.targetData.startupFn},processed:!0});return}s.length>0&&s[0].constructor!==Array&&(s=[s]),s.forEach(m=>{const Y=String(Object.keys(r.currentVideoTargets).length);r.currentVideoTargets[Y]={page:e.targetData.page,id:Y,current_state_id:xe.value.id,region:m,top:e.targetData.top,left:e.targetData.left,makeCutout:y,parentCanvas:e.targetData.id,cutouts:[],startupFn:T=>{T.emitter.emit("deselect"),delete T.targetData.startupFn},processed:!0}})},ne=w(null),ae=(s=!1)=>{o.emit("changeVideoFrame",[e.instanceID,D.value,S.value,f.value,s])},le=(s,y=!0)=>{if(!(_.value||!s)){if(ne.value.restore(),ne.value.save(),ne.value.fillStyle="rgba(0, 0, 0, 0)",ne.value.clearRect(0,0,Z.value,B.value),e.targetData.drawImage!==!1){const I=s.videoWidth/s.clientWidth,m=s.videoHeight/s.clientHeight;ne.value.drawImage(s,0,0,Z.value*I,B.value*m,0,0,Z.value,B.value)}!pe.value&&U.value&&q(ne.value,U.value),y&&o.emit("post_redraw"+e.targetData.id),d(),_.value=!0,setTimeout(()=>_.value=!1,20)}},d=()=>{if(e.targetData.processed||!b.value)return;const s=cv.imread(b.value);cv.cvtColor(s,s,cv.COLOR_RGBA2GRAY,0),cv.threshold(s,s,254,255,cv.THRESH_BINARY);const y=new cv.MatVector,I=new cv.Mat;cv.findContours(s,y,I,cv.RETR_TREE,cv.CHAIN_APPROX_SIMPLE);const m=[],Y=Array.from(I.data32S);for(;Y.length>0;)m.push(Y.splice(0,4));const T=[];m.forEach((R,oe)=>{R[2]!=-1&&R[3]==-1&&T.push(oe)});function X(R,oe){const Be={left:R.x,top:R.y,right:R.x+R.width,bottom:R.y+R.height},je={left:oe.x,top:oe.y,right:oe.x+oe.width,bottom:oe.y+oe.height};return!(je.left>Be.right||je.right<Be.left||je.top>Be.bottom||je.bottom<Be.top)}const Q=T.filter(R=>cv.contourArea(y.get(parseInt(R)),!1)>1e3).map(R=>cv.boundingRect(y.get(parseInt(R)))).sort((R,oe)=>R.width*R.height>oe.width*oe.height).filter((R,oe,Be)=>!Be.slice(oe+1).some(je=>X(je,R))).filter(R=>Math.abs(Z.value-R.width)>100&&Math.abs(B.value-R.height)>100).map(P.rectToPoly);Q.length!=0&&se(Q,!0,!0),s.delete(),y.delete(),I.delete(),t.emit("frame_processed")},f=w(null),_=w(!1),K=w(!0),j=(s,y=0,I=!0,m=!0)=>{W(e.targets[s].frame_no,y,I,m)},W=(s,y=0,I=!0,m=!0)=>{const Y=s+1+y;if(f.value==Y)return;o.emit("changeVideoFrame",[e.instanceID,D.value,S.value,f.value,Y,m])[0].some(Q=>Q.instance==he.value&&Q.page==D.value&&Q.vcid==S.value)&&(f.value=Y,I&&K.value&&r.changeStateWithFrameNo(s,y),e.targetData.current_state_id=Object.values(e.targets).find(Q=>Q.frame_no==s).id)},ce=(s,y)=>{r.updateInteractionHistory(s,y,e.targetData.id)},fe=_e({}),xe=H(()=>Object.values(e.targets).find(s=>s.id==e.targetData.current_state_id)||Object.values(e.targets).sort((s,y)=>s.frame_no-y.frame_no)[0]),Qe=H(()=>P.currentTargets(xe.value,e.targets)),yt=s=>{if(s.id=="-1")return;const y=`loom${s.actor.charAt(0).toUpperCase()+s.actor.slice(1)}`;if(Ie[e.renderAppMode]&&Ie[e.renderAppMode].mappings){const I=Ie[e.renderAppMode].mappings[y];if(I&&a.components[I])return a.components[I]}if(a.components[y])return a.components[y]};et(()=>{if(ne.value=b.value.getContext("2d"),ne.value.save(),D.value==r.currentPage&&e.start_state_id!==void 0&&(e.targetData.current_state_id=e.start_state_id),xe.value!==void 0&&(j(xe.value.id,0,!1),e.targetData.region?be[z.value]=e.targetData.region:be[z.value]=[{x:0,y:0},{x:Z.value,y:0},{x:Z.value,y:B.value},{x:0,y:B.value}],e.targetData.makeCutout&&r)){const s=U.value,y=Math.min(...s.map(T=>T.x)),I=Math.max(...s.map(T=>T.x)),m=Math.min(...s.map(T=>T.y)),Y=Math.max(...s.map(T=>T.y));ge.value&&ge.value.targetData.cutouts.push({poly:U.value,width:I-y,height:Y-m,top:m,left:y,id:e.targetData.id})}e.targetData.startupFn&&e.targetData.startupFn(k.value),o.on("clearSelection",L),o.on("deselect",A),o.on(`changeState-${e.targetData.id}`,j),o.on("mousemove",v),o.on("mouseup",C),o.on("mousedown",M),$e.value=!0,o.emit("selectVideoCanvas",k.value)}),kt(()=>{if(ge.value&&ge.value.targetData){const s=ge.value.targetData.cutouts.findIndex(y=>y.id===e.targetData.id);s>=0&&ge.value.targetData.cutouts.splice(s,1)}o.off("clearSelection",L),o.off("deselect",A),o.off(`changeState-${e.targetData.id}`,j),o.off("mousemove",v),o.off("mouseup",C),o.off("mousedown",M)});const lt={utils:P,zIndex:p,selected:$e,dragStart:V,dragCurr:E,lastMouseLoc:Le,mouseLoc:O,dragging:Re,reshapePolygonMode:we,resizePolygonMode:Ce,ctx:ne,polygonMasks:be,polygonReshapeIdx:Te,updateParentCurrentState:K,lastFrame:f,throttle:_,dragMode:pe,scale:i,loomVideoCanvasRefs:l,componentRefs:fe,instanceRef:r,canvasRef:b,containerRef:u,current_state:xe,currentTargets:Qe,id:S,page:D,mode:J,instance:he,width:Z,scaledWidth:De,height:B,scaledHeight:ue,top:Fe,left:He,parentCanvasRef:ge,currentPolygonMaskID:z,currentPolygonMask:U,currentPolygonMaskScaled:me,currentPolygonMaskString:Ee,currentPolygonMaskStringScaled:Xe,regionExists:re,dragSelectStyle:c,getComponent:yt,changeState:j,changeStateWithFrameNo:W,addHistory:ce,cutSelectedRegion:Oe,copyRegions:te,cutRegions:se,resizePolygon:Se,reshapePolygon:ve,addNewVertex:de,isPolygonVertexHovered:Pe,isPolygonLineHovered:ye,clientToOffset:g,onScreenMouseMove:v,onScreenMouseDown:M,onVideoMouseDown:x,onScreenMouseUp:C,drawPolyOutline:q,redraw:ae,draw:le,processFrame:d,clearSelection:L,deselect:A};return st(`videoCanvas-${S}`,lt),lt}},oa={"pointer-events":"none"},sa=["id"],ia=["points"],ra=["width","height"],la={class:"offset",style:{position:"absolute",top:"0px",left:"0px"}},ca=["width","height"],ua=["points"];function da(e,t,n,a,o,l){return N(),G("div",{ref:"containerRef",style:ee([{height:"0px",width:"0px","pointer-events":"auto"},{zIndex:e.zIndex}])},[(N(),G("svg",oa,[h("clipPath",{id:`clipping-${n.instanceID}-${n.targetData.id}`},[h("polygon",{"pointer-events":"fill",points:e.currentPolygonMask?e.currentPolygonMaskStringScaled:null},null,8,ia)],8,sa)])),h("div",{style:ee({position:"absolute",top:e.top+"px",left:e.left+"px",clipPath:`url(#clipping-${n.instanceID}-${e.id})`}),onClick:t[0]||(t[0]=r=>{e.dragging=!1,e.emitter.emit("clickVideoCanvas",r)}),onMousedown:t[1]||(t[1]=(...r)=>e.onVideoMouseDown&&e.onVideoMouseDown(...r)),onMouseleave:t[2]||(t[2]=r=>e.dragging=!1)},[h("div",null,[h("canvas",{ref:"canvasRef",width:e.width,height:e.height,style:ee({width:(e.width*e.scale.x).toPrecision(4)+"px",height:(e.height*e.scale.y).toPrecision(4)+"px",zIndex:e.zIndex})},null,12,ra),h("div",{style:ee(e.dragSelectStyle)},null,4),h("div",{class:"overlay",style:ee([{display:n.overlay?"block":"none"},{position:"absolute",top:"0px",left:"0px",width:"100%",height:"100%","background-color":"rgba(0, 0, 0, 0.5)"}])},null,4)]),h("div",la,[(N(!0),G(ze,null,We(e.currentTargets,r=>(N(),Ke(Dt(e.getComponent(r)),{key:r.id,ref_for:!0,ref:p=>{p&&(e.componentRefs[r.id]=p)},targetData:r,vcTargetData:n.targetData,targets:n.targets,showHint:n.overlay,interactable:!n.regionSelect,onChangeState:e.changeState,onAddHistory:e.addHistory},null,8,["targetData","vcTargetData","targets","showHint","interactable","onChangeState","onAddHistory"]))),128))]),(N(!0),G(ze,null,We(n.targetData.cutouts,(r,p)=>(N(),G("svg",{key:p,width:(e.width*e.scale.x).toPrecision(4),height:(e.height*e.scale.y).toPrecision(4),style:ee({width:(e.width*e.scale.x).toPrecision(4),height:(e.height*e.scale.y).toPrecision(4),top:"0px",left:"0px",position:"absolute",fill:"black"}),"pointer-events":"none"},[h("polygon",{"pointer-events":"fill",points:e.utils.polyToPolyString(e.utils.scalePolygon(r.poly,e.scale),0,0)},null,8,ua)],12,ca))),128))],36)],4)}var fa=ke(aa,[["render",da]]);const ha={name:"LoomInstance",components:{loomVideoCanvas:fa},props:{renderMode:String,videoTargetCache:{type:Object,default:{}},video_filename:{type:String,default:"video.mp4"},directory:String,regionSelect:Boolean,overlay:Boolean,dragMode:Boolean,id:String,name:String},setup(e,t){const n=Ye("emitter"),{appConfig:a,linkData:o,appRefs:l,zip:r}=Ye("manager"),p=w(!1),i=w(null),u=w(null),b=w(null),k=c=>{for(let g=0;g<Ce.value;++g)S(g,c)},S=(c,g)=>{const v={id:c,promises:[]};U.push(v),Je(()=>{const M=D(Ee[c],g);M?v.player=M:console.error("No Player!")})},D=(c,g)=>{const v=ht.getPlayer(c);if(v)return v;const M={sources:[{src:"data:video/mp4;base64,"+btoa(g),type:"video/mp4"}],controls:!1,loadingSpinner:!1,controlBar:!1};return ht(c,M,function(){this.on("click",function(x){x.preventDefault()})})},J=()=>p.value?Promise.resolve([u,a.value]):fetch(e.directory+".rva").then(c=>c.blob()).then(async c=>{const v=await new r.ZipReader(new r.BlobReader(c)).getEntries(),M=await v[1].getData(new r.BlobWriter);let x=new FileReader;return x.onloadend=L=>k(L.target.result),x.readAsBinaryString(M),v[0].getData(new r.TextWriter)}).then(c=>JSON.parse(c)).catch(c=>null).then(c=>c==null?(console.error(`ERROR, IS_config not loaded
`),[null,null]):c.info.version!=Ie.version?(console.error("ERROR, out of version IS_config file, run Recorder/convert.py"),[null,null]):(u.value=c,b.value=u.value.hasOwnProperty(i.value)?u.value[i.value]:u.value.original,p.value=!0,de.hidden={},e.videoTargetCache.hidden={},de.original=u.value.original.data,[u,a.value])),he=c=>(i.value=`${c.value}_${c.renderMode}`,J().then(([g,v])=>{if(g===null||v===null)return;c.selected||(i.value="hidden"),be(i.value,c.renderMode),Z(v,c.value,c.renderMode),De(i.value),B.value=Object.values(Se.value).filter(x=>x.frame_no>0).sort((x,C)=>x.frame_no-C.frame_no)[1],He(B.value.id);const M=Object.values(o.linkedCanvases.sets).find(x=>x.data.instance==e.id);if(M){const x=M.data;n.emit("changeVideoFrame",[x.instance,x.page,x.vcid,-1,x.frame,!1])}})),Z=(c,g,v)=>{const M=`${g}_${v}`;if(!c||c[M]===void 0)return;const x=c[M],C=P.deepCopy(x);for(const L of Object.values(C))for(const A of Object.values(L)){A.processed=A.processed===void 0?Boolean(A.cutouts&&A.cutouts.length>0):A.processed,A.cutouts=A.cutouts||[];const re=g,Oe=A.linkedFrames||[];for(const te of Oe){const se={mode:v,instance:re,page:A.page,vcid:A.id};for(const ne of te.frames){const ae=Ue(Ae({},se),{frame:ne[0]}),le=Ue(Ae({},te),{frame:ne[1]}),d=`${ae.instance}_${ae.page}_${ae.vcid}_${ae.frame}`,f=`${le.instance}_${le.page}_${le.vcid}_${le.frame}`;o.linkedCanvases.exists(d)||o.linkedCanvases.add(d,ae),o.linkedCanvases.exists(f)||o.linkedCanvases.add(f,le),o.linkedCanvases.merge(d,f)}}if(A.parentCanvas&&A.parentCanvas!="-1"){const te=ve[A.parentCanvas];if(A.makeCutout&&te){te.targetData.cutouts=A.parentCanvas.cutouts||[];const se=A.region,ne=Math.min(...se.map(_=>_.x)),ae=Math.max(...se.map(_=>_.x)),le=Math.min(...se.map(_=>_.y)),d=Math.max(...se.map(_=>_.y));te.targetData.cutouts.push({poly:se,width:ae-ne,height:d-le,top:le,left:ne,id:A.id})}}}for(let L in x)e.videoTargetCache[M][L]=x[L]},De=c=>{e.videoTargetCache.hasOwnProperty(c)||V({processed:!1},c)},B=w(null),ue=_e([]),Fe=w(30),He=(c,g=0)=>{const v=Se.value[c];if(v===void 0){console.error("Invalid state");return}ge(v.frame_no)},ge=c=>{B.value=Object.values(Se.value).find(g=>g.frame_no==c)},be=(c,g)=>{de.hasOwnProperty(c)||(u.value.hasOwnProperty(c)||(u.value[c]=Pn(u.value,de.original,g)),de[c]=u.value[c].data||{})},Te=(c,g,v)=>{const M={id:c.id,videoCanvas:v,target:c,event:g};ue.push(M),ue.length>Fe.value&&ue.shift(),n.emit("runInteractionAnalysis",ue)},we=w(30),Ce=w(3),U=_e([]),me=w(0),Ee=_e({}),Xe=(c,g,v,M=!0)=>{if(!v&&v!==0){ve[g].draw(null,M);return}const x=U[me.value];!x||(me.value=(me.value+1)%Ce.value,new Promise((C,L)=>{x.promises.push(C),x.inUse||C(C),setTimeout(()=>L(C),1e3)}).then(C=>{const L=x.promises.findIndex(A=>A==C);x.player.on("timeupdate",function A(){const re=Ee[x.id];!re||(ve[g]&&ve[g].draw(re,M),x.player.off("timeupdate",A),x.promises[L+1]&&x.promises[L+1](x.promises[L+1]),x.inUse=!1,x.promises.splice(L,1))}),x.inUse=!0,x.player.currentTime(v/we.value)}).catch(C=>{const L=x.promises.findIndex(A=>A==C);x.promises.splice(L,1),console.warn("frame took too long")}))},z=(c,g)=>{const v=l[c.instance].renderAppMode;e.videoTargetCache[v][c.page][c.vcid].linkedFrames==null&&(e.videoTargetCache[v][c.page][c.vcid].linkedFrames=[]);const M=e.videoTargetCache[v][c.page][c.vcid].linkedFrames,x=M.find(C=>C.mode==g.mode&&C.page==g.page&&C.vcid==g.vcid);if(x!=null)x.frames=x.frames||[],x.frames.push([c.frame,g.frame]);else{const C=Ae({},g);c.instance!=g.instance&&(delete C.frame,C.frames=[[c.frame,g.frame]]),M.push(C)}},Se=H(()=>{const c=P.shallowCopy(de.original);delete c.mode;const g=P.shallowCopy(de[i.value]||{});return delete g.mode,P.deepMerge(c,g)}),ve=_e({}),de=_e({}),Pe=H(()=>{if(!B.value||!e.videoTargetCache[i.value])return[null,null];let c=null,g="-1";for(let v=B.value;c===null&&v&&v.id!=v.parent_id;v=Se.value[v.parent_id]){if(typeof v.frame_no=="string"&&v.frame_no.includes("frameless"))continue;const M=Object.entries(e.videoTargetCache[i.value]);for(let x=0;x<M.length;++x)if(String(v.id)===M[x][0]){c=M[x][1],g=M[x][0];break}}return c===null&&(c=e.videoTargetCache[i.value]["-1"]),[g,c]}),ye=H(()=>Pe.value[1]),q=H(()=>Pe.value[0]),V=async(c={},g=void 0,v=!1)=>{g===void 0&&(g=i.value);let M="-1",x=0;e.videoTargetCache.hasOwnProperty(g)?(c.newPageFromRoot===!1?M=q.value:M=String(B.value.id),x=M):e.videoTargetCache[g]={};const C=P.rectToPoly({x:0,y:0,width:u.value.info.window.width,height:u.value.info.window.height});(!e.videoTargetCache[g][M]||v)&&(e.videoTargetCache[g][M]={});const L=String(Object.keys(e.videoTargetCache[g][M]).length);return e.videoTargetCache[g][M][L]=Ae({page:M,id:L,current_state_id:x,region:C,top:0,left:0,makeCutout:!1,parentCanvas:!1,cutouts:[],startupFn:null,processed:!0},c),await Je(()=>ve[L])},pe={IS_config:u,currentConfig:b,current_state:B,loaded:p,renderAppMode:i,transformedTargetCache:de,videoPlayers:U,interactionHistory:ue,maxHistoryLength:Fe,numVideoPlayers:Ce,lastUsedVideoPlayer:me,targets:Se,computeCurrentVideoTargets:Pe,currentVideoTargets:ye,currentPage:q,setupVideo:D,load:J,init:he,init_videoTargetCache:Z,updateInteractionHistory:Te,addInstanceLink:z,changeState:He,changeStateWithFrameNo:ge,targetCacheModeChange:be,newVideoTarget:V,destroyVideoTarget:async(c,g,v)=>{delete e.videoTargetCache[c][g][v]},changeVideoFrame:Xe,createNewVideoPlayer:S,videoCacheModeChange:De,Up:c=>{c.zIndex++},Down:c=>{c.zIndex--},Delete:c=>{let g=null;c===null&&ye.value!==null?g="-1":c&&(g=c.id),g!==null&&delete ye.value[g]},paste:c=>{if(!c)return;const g=c.startupFn,v=P.deepCopy(c);for(v.startupFn=M=>{M.updateParentCurrentState=!1,g&&g(M)},v.id="0";ye.value[v.id]!==void 0;)v.id=String(parseInt(v.id)+1);ye.value[v.id]=v},loomVideoCanvasRefs:ve,videoPlayerRefs:Ee};return st(`instance-${e.id}`,pe),pe}};function ga(e,t,n,a,o,l){const r=Ne("loom-video-canvas");return N(),G("div",{id:"loom",style:ee({height:e.IS_config?e.IS_config.info.window.height+"px":"0px",width:e.IS_config?e.IS_config.info.window.width+"px":"0px",position:"absolute","margin-left":"auto","margin-right":"auto",left:0,right:0,"text-align":"center","pointer-events":"none"})},[(N(!0),G(ze,null,We(e.videoPlayers,(p,i)=>(N(),G("video",{key:i,ref_for:!0,ref:u=>{u&&(e.videoPlayerRefs[p.id]=u)},style:ee([{width:e.IS_config?e.IS_config.info.window.width+"px":"0px",height:e.IS_config?e.IS_config.info.window.height+"px":"0px"},{position:"absolute",top:"0px",left:"0px",visibility:"hidden"}]),class:"video-js",crossorigin:"anonymous"},null,4))),128)),(N(!0),G(ze,null,We(e.currentVideoTargets,p=>(N(),Ke(r,{key:`${e.renderAppMode}-${p.page}-${p.id}`,ref_for:!0,ref:i=>{i&&(e.loomVideoCanvasRefs[p.id]=i)},instanceID:n.id,targets:p.targets||e.targets,targetData:p,start_state_id:e.current_state.id,regionSelect:n.regionSelect,overlay:n.overlay,renderMode:n.renderMode,renderAppMode:e.renderAppMode,currentConfig:e.currentConfig,info:e.IS_config.info,dragMode:n.dragMode,onFrame_processed:()=>p.processed=!0},null,8,["instanceID","targets","targetData","start_state_id","regionSelect","overlay","renderMode","renderAppMode","currentConfig","info","dragMode","onFrame_processed"]))),128))],4)}var pa=ke(ha,[["render",ga],["__scopeId","data-v-27ef4790"]]);function ma(e,t=0,n=-1){this.rank=t,this.parent=n,this.data=e,this.children=[]}function mt(){this.sets={},this.nsets=0}mt.prototype={add(e=void 0,t=void 0){return e==null&&(e=this.sets.length),this.sets.hasOwnProperty(e)?null:(this.sets[e]=new ma(t),this.sets[e].children.push(e),++this.nsets,e)},find(e){return this.sets[e]?this.sets[e].parent==-1?e:(this.sets[e].parent=this.find(this.sets[e].parent),this.sets[e].parent):null},transferChildren(e,t){const n=this.sets[e],a=this.sets[t];a.children=a.children.concat(n.children),n.children=[]},merge(e,t){if(e=this.find(e),t=this.find(t),e==null||t==null)return null;if(e!=t){const n=this.sets[e],a=this.sets[t];n.rank>a.rank?(a.parent=e,this.transferChildren(t,e)):n.rank<a.rank?(n.parent=t,this.transferChildren(e,t)):(a.parent=e,++n.rank,this.transferChildren(t,e)),--this.nsets}return this.find(e)},of(e){return this.sets[this.find(e)].children.map(t=>this.sets[t].data)},connected(e,t){return this.find(e)===this.find(t)},at(e){return this.sets[e].data},exists(e){return this.sets.hasOwnProperty(e)},size(){return this.nsets}};$t({useWebWorkers:!1});const va={components:{loomInstance:pa,Multiselect:It},props:["directory","modifier_directory"],setup(e,t){const n=w(null),a=w(null),o=w(null),l=w(!1),r=w(null),p=w(120),i=w(!1),u=w(!0),b=w(!1),k=w(null),S=w(null),D=()=>{i.value=!i.value,o.value.checked=!1,l.value=!1,a.value.checked=!1,u.value=!0},J=()=>{l.value=!l.value,r.value.checked=!1,i.value=!1},he=d=>{Oe.value=d,se()},Z=d=>{re.value=d,se()},De=()=>{C[z.value.instanceID]&&C[z.value.instanceID].Up(z.value)},B=()=>{C[z.value.instanceID]&&C[z.value.instanceID].Down(z.value)},ue=()=>{C[z.value.instanceID]&&C[z.value.instanceID].Delete(z.value)},Fe=()=>{S.value=z.value},He=()=>{Fe(),ue()},ge=()=>{const d=S.value;Fe(),be(),S.value=d},be=()=>{if(C[S.value.instanceID]){const d=P.deepCopy(S.value.targetData);d.makeCutout=!1,C[S.value.instanceID].paste(d)}},Te=()=>{let d="None";te.value.startState&&te.value.startState.saveName&&(d=te.value.startState.saveName);let f=prompt(`Enter name to save config as: (default: ${d})`);if(!f){if(!d||d=="None")return;f=d}const _=new Set(JSON.parse(localStorage.getItem("saveNames")))||new Set;_.has(f)&&!confirm("Name already taken")||(_.add(f),te.value.startState={saveName:f,appMode:re.value},Je(()=>{try{localStorage.setItem("saveNames",JSON.stringify([..._])),localStorage.setItem(f,JSON.stringify(te.value))}catch(K){alert(`Could not save to localStorage: ${String(K)}`),console.error(K)}}))},we=d=>{let f=new Set(g.value.map(j=>j.split(".")[0])),_=localStorage.getItem("saveNames");if(_&&(_=JSON.parse(_),_.forEach(j=>f.add(j))),!f)return alert("No files to load"),!1;f=Array.from(f);function K(j){if(te.value=j,te.value.startState&&te.value.startState.appMode){const W=te.value.startState.appMode;W.forEach(ce=>{const fe=e.directory+"/"+ce,xe=fe.split("/").filter(Qe=>Qe!="").slice(-1)[0].replaceAll(" ","_");L.push({directory:fe,label:xe.charAt(0).toUpperCase()+xe.slice(1),minLabel:(xe.charAt(0).toUpperCase()+xe.slice(1)).substr(0,4)+"...",value:xe})}),re.value=W.map(ce=>ce.split().join("_"))}Je(se)}if(d===void 0&&(d=prompt(`Enter file (blank to upload)
 Available names: `+f.join(", "))),d==="")Ce().then(j=>{const W=new FileReader;W.onload=ce=>{K(JSON.parse(ce.target.result)),Te()},W.readAsText(j)});else if(f.some(j=>j==d)){const j=f.indexOf(d),W=c.value[j];return K(W||JSON.parse(localStorage.getItem(d))),!0}else return alert("File does not exist"),!1};function Ce(){return new Promise(d=>{let f=document.createElement("input");f.type="file",f.onchange=_=>{let K=Array.from(f.files);d(K[0])},f.click()})}const U=w([]),me=([d,f])=>{U.value[d]=f},Ee=d=>{delete U[d]},Xe=d=>P.getComponentFromPoint(le,d.x,d.y),z=w(null),Se=d=>{q.linkMode!=="selectable"&&(i.value=!1,Je(()=>{const f=Xe(d);if(q.linkMode==="linkingFrom")q.firstLink=V(z.value,f),q.linkMode="linkingTo";else if(q.linkMode==="linkingTo"){const _=V(z.value,f);E(q.firstLink,_),q.linkMode="selectable"}i.value=!0}))},ve=async(d=null,f=void 0,_=!0)=>{if(C[z.value.instanceID])return await C[z.value.instanceID].newVideoTarget(d,f,_)},de=d=>{C[d.instanceID].destroyVideoTarget(d.mode,d.page,d.id)},Pe=()=>{u.value=!0,a.value.checked=!1,k.value.cutSelectedRegion()},ye=(d,f,_,K,j,W)=>{if(q.linkedCanvases.exists(`${d}_${f}_${_}_${j}`)){const ce=[];return q.linkedCanvases.of(`${d}_${f}_${_}_${j}`).forEach(fe=>{fe.componentID===void 0&&C[fe.instance]&&(C[fe.instance].changeVideoFrame(fe.page,fe.vcid,fe.frame,W),ce.push({instance:fe.instance,page:fe.page,vcid:fe.vcid}))}),ce}else{const ce=[];return C[d]&&(C[d].changeVideoFrame(f,_,j,W),ce.push({instance:d,page:f,vcid:_})),ce}},q=_e({linkMode:"selectable",firstLink:null,linkedCanvases:new mt}),V=(d,f)=>{let _=null;return f==null?_={mode:d.renderMode.value,instance:d.instanceID,page:d.page,vcid:d.id,frame:d.lastFrame}:_={mode:d.renderMode.value,instance:d.instanceID,page:d.page,vcid:d.id,frame:f.frame,componentID:f.componentID},_},E=(d,f)=>{let _,K;K=`${d.instance}_${d.page}_${d.vcid}_${d.frame}`,_=`${f.instance}_${f.page}_${f.vcid}_${f.frame}`,q.linkedCanvases.exists(K)||q.linkedCanvases.add(K,d),q.linkedCanvases.exists(_)||q.linkedCanvases.add(_,f),q.linkedCanvases.merge(K,_),z.value.instanceRef.addInstanceLink(d,f),q.firstLink=null},Le=H(()=>({none:{color:"grey",cursor:"default"},selectable:{color:"white",cursor:"pointer"},linkingFrom:{color:"green",cursor:"pointer"},linkingTo:{color:"red",cursor:"pointer"}})[q.linkMode]),O=_e({mapLinkMode:"selectable",firstLink:null,mapComponent:null}),$e=async d=>{const f=()=>{O.mapComponent!=null&&de(O.mapComponent.$parent),O.mapLinkMode="selectable",O.firstLink=null,O.mapComponent=null};if(O.mapLinkMode=="selectable"){if(O.mapComponent!=null)return;O.mapComponent=(await Re()).componentRefs["0"],O.mapLinkMode="linkingFrom"}else if(O.mapLinkMode=="linkingFrom")O.firstLink=await O.mapComponent.getMapping(),O.mapLinkMode="linkingTo";else if(O.mapLinkMode=="linkingTo"){const _=await O.mapComponent.getMapping(),K=O.firstLink;Object.keys(_).forEach(j=>{K.hasOwnProperty(j)&&E(K[j],_[j])}),f()}},Re=async()=>{const d=550,f=315;return await ve({reshapeable:!1,resizeable:!0,region:P.rectToPoly({x:0,y:0,width:d,height:f}),width:d,height:f,targets:[{actor:"USA",id:"0",important:!0}],startupFn:_=>{_.lastFrame=0,delete _.targetData.startupFn},drawImage:!1,newPageFromRoot:!1,current_state_id:"0"},void 0,!1)},pe=H(()=>({cursor:"pointer",color:{selectable:"white",linkingFrom:"green",linkingTo:"red"}[O.mapLinkMode]})),c=w(null),g=w(null),v=w(!1),M=w(null),x=w(null),C=_e({}),L=_e([]),A=_e([]),re=w(null),Oe=w(null),te=w({}),se=()=>{if(!re.value)return;L.map(f=>Ae({selected:re.value.includes(f.value)},f)).forEach(async f=>{const _=Ue(Ae({},f),{renderMode:Oe.value});C.hasOwnProperty(f.value)&&await C[f.value].init(_)})},ne=function(d){return fetch("https://api.github.com/repos/branson2015/DeRe_Apps/git/trees/main?recursive=1").then(_=>_.json()).then(_=>{const K=_.tree.map(W=>W.path).filter(W=>W.substr(0,"demos/demos/".length)==="demos/demos/").map(W=>W.substr("/demos/demos".length));g.value=K;const j=K.map(W=>fetch(`${e.modifier_directory}/${W}`).then(ce=>ce.json()));return Promise.all(j).then(W=>{c.value=W})})},ae=async function(){for(;!we("hero");)await P.sleep(1e3)};et(()=>{window.location.hash.substr(1)==="Edit"&&(v.value=!0),ne(e.modifier_directory).then(ae),window.app=le;const d=Ye("emitter");d.on("regionExists",f=>{b.value=f.exists,k.value=f.origin}),d.on("clickVideoCanvas",Se),d.on("selectVideoCanvas",f=>{z.value=f}),d.on("changeVideoFrame",f=>ye(...f)),d.on("addComponent",me),d.on("removeComponet",Ee),["Desktop","Mobile"].forEach(f=>A.push({value:f.toLowerCase(),label:f})),Oe.value=A[0].value,x.value.select(Oe.value)});const le={editMode:v,appModes:L,renderModes:A,appMode:re,renderMode:Oe,regionSelect:i,hintHelpState:l,dragMode:u,regionExists:b,regionOrigin:k,currVideoCanvasSelected:z,pasteBin:S,linkData:q,mapLinkData:O,appConfig:te,loomMenuWidth:p,activeComponents:U,mapLinkStyle:pe,linkVideoCanvasStyle:Le,init:se,addMap:Re,newVideoTarget:ve,destroyVideoTarget:de,cutRegion:Pe,toggleRegion:D,toggleHintHelp:J,onRenderModeChange:he,onAppModeChange:Z,saveVideoCanvasState:Te,loadVideoCanvasState:we,mapLinkClicked:$e,videoCanvasClicked:Se,createLinkEntry:V,createLink:E,changeVideoFrame:ye,Up:De,Down:B,Delete:ue,copy:Fe,cut:He,duplicate:ge,paste:be,addComponent:me,removeComponent:Ee,managerRef:n,appModeRef:M,renderModeRef:x,regionToggleRef:r,helpToggleRef:o,selectModeRef:a,appRefs:C,utils:P,zip:Tt};return st("manager",le),le}},F=e=>(Pt("data-v-f826e666"),e=e(),Rt(),e),ya={ref:"managerRef"},xa={id:"loom-menu-linking",style:{position:"fixed",width:"100%",height:"80px",bottom:"0px",margin:"0 auto"}},_a=F(()=>h("span",{class:"title",style:{"grid-column":"1/-1"}},"Linking",-1)),ba={style:{"grid-column":"1"}},wa=F(()=>h("br",null,null,-1)),Ca=F(()=>h("span",null,"Hints",-1)),Sa=Me(),Ma=F(()=>h("br",null,null,-1)),ka=F(()=>h("span",null,"link map",-1)),Da=F(()=>h("br",null,null,-1)),$a=F(()=>h("span",{class:"title"},"Tools",-1)),Ia=F(()=>h("span",{class:"text",style:{"margin-top":"0px"}},"Regions",-1)),Ta={class:"grid-container"},Pa=F(()=>h("span",{class:"text"},"Canvas",-1)),Ra=Me(),Oa=F(()=>h("br",null,null,-1)),Aa=F(()=>h("span",{class:"text"},"Region",-1)),Va=Me(),Fa=F(()=>h("br",null,null,-1)),Ea=F(()=>h("span",{class:"text"},"Cut",-1)),La=Me(),Na=F(()=>h("br",null,null,-1)),Ha=F(()=>h("span",{class:"text"},"Copy",-1)),Ba=Me(),ja=F(()=>h("br",null,null,-1)),Ua=F(()=>h("span",{class:"text"},"Duplicate",-1)),za=Me(),Wa=F(()=>h("br",null,null,-1)),Ya=F(()=>h("span",{class:"text"},"Paste",-1)),Xa=Me(),Ja=F(()=>h("br",null,null,-1)),qa=F(()=>h("span",{class:"text"},"Delete",-1)),Ka=Me(),Ga=F(()=>h("br",null,null,-1)),Za=F(()=>h("span",{class:"text"},"Up",-1)),Qa=Me(),eo=F(()=>h("br",null,null,-1)),to=F(()=>h("span",{class:"text"},"Down",-1)),no=Me(),ao=F(()=>h("br",null,null,-1)),oo=F(()=>h("span",{class:"text",style:{"margin-top":"10px"}},"Region Edit",-1)),so=F(()=>h("span",{class:"title"},"DeRe",-1)),io=Me(" \xA0 "),ro=F(()=>h("span",{class:"text",style:{"margin-top":"40px"}},"Mode",-1)),lo=F(()=>h("span",{class:"text",style:{"margin-top":"40px"}},"App",-1)),co={style:{position:"relative"}};function uo(e,t,n,a,o,l){const r=Ne("font-awesome-icon"),p=Ne("multiselect"),i=Ne("loom-instance");return N(),G("div",ya,[it(h("div",xa,[h("div",null,[_a,h("div",ba,[h("input",{ref:"helpToggleRef",onClick:t[0]||(t[0]=(...u)=>e.toggleHintHelp&&e.toggleHintHelp(...u)),type:"checkbox",class:"sidebar-toggle apple-switch btn btn-default",style:{height:"20px",width:"40px !important"}},null,512),wa,Ca]),h("div",{style:ee([{"grid-column":"2",margin:"5px 0"},e.mapLinkStyle])},[ie(r,{icon:"map",onClick:e.mapLinkClicked},null,8,["onClick"]),Sa,Ma,ka],4),h("div",{style:ee([{"grid-column":"3",margin:"5px 0"},e.linkVideoCanvasStyle])},[ie(r,{icon:"link",onClick:t[1]||(t[1]=()=>{e.linkData.linkMode=e.linkData.linkMode=="selectable"?"linkingFrom":"selectable"})}),Da,h("span",null,ft(e.linkData.linkMode=="linkingFrom"?"linking":e.linkData.linkMode=="linkingTo"?"link to":"link"),1)],4)])],512),[[rt,e.editMode]]),it(h("div",{id:"loom-menu-tools",style:ee({position:"fixed",width:e.loomMenuWidth,top:"150px",right:"0px"})},[$a,Ia,h("input",{ref:"regionToggleRef",onClick:t[2]||(t[2]=(...u)=>e.toggleRegion&&e.toggleRegion(...u)),type:"checkbox",class:"sidebar-toggle apple-switch btn btn-default"},null,512),h("div",Ta,[h("div",{style:{"grid-area":"newCanvas"},class:Ve((e.regionSelect,"inactiveInput"))},[Pa,Ra,Oa,ie(r,{icon:"plus-square",onClick:t[3]||(t[3]=u=>(e.regionSelect,null))})],2),h("div",{style:{"grid-area":"cutRegion"},class:Ve(e.regionSelect&&e.regionExists?"activeInput":"inactiveInput")},[Aa,Va,Fa,ie(r,{icon:"border-none",onClick:t[4]||(t[4]=u=>e.regionSelect&&e.regionExists?e.cutRegion(u):null)})],2),h("div",{stlye:"grid-area: cut",class:Ve(e.regionSelect&&e.currVideoCanvasSelected?"activeInput":"inactiveInput")},[Ea,La,Na,ie(r,{icon:"cut",onClick:t[5]||(t[5]=u=>e.regionSelect&&e.currVideoCanvasSelected?e.cut(u):null)})],2),h("div",{stlye:"grid-area: copy",class:Ve(e.regionSelect&&e.currVideoCanvasSelected?"activeInput":"inactiveInput")},[Ha,Ba,ja,ie(r,{icon:"copy",onClick:t[6]||(t[6]=u=>e.regionSelect&&e.currVideoCanvasSelected?e.copy(u):null)})],2),h("div",{stlye:"grid-area: dup",class:Ve(e.regionSelect&&e.currVideoCanvasSelected?"activeInput":"inactiveInput")},[Ua,za,Wa,ie(r,{icon:"clone",onClick:t[7]||(t[7]=u=>e.regionSelect&&e.currVideoCanvasSelected?e.duplicate(u):null)})],2),h("div",{style:{"grid-area":"paste"},class:Ve(e.regionSelect&&e.pasteBin?"activeInput":"inactiveInput")},[Ya,Xa,Ja,ie(r,{icon:"paste",onClick:t[8]||(t[8]=u=>e.regionSelect&&e.pasteBin?e.paste(u):null)})],2),h("div",{stlye:"grid-area: delete",class:Ve(e.regionSelect&&e.currVideoCanvasSelected?"activeInput":"inactiveInput")},[qa,Ka,Ga,ie(r,{icon:"trash",onClick:t[9]||(t[9]=u=>e.regionSelect&&e.currVideoCanvasSelected?e.Delete(u):null)})],2),h("div",{style:{"grid-area":"upZ"},class:Ve(e.regionSelect&&e.currVideoCanvasSelected?"activeInput":"inactiveInput")},[Za,Qa,eo,ie(r,{icon:"arrow-up",onClick:t[10]||(t[10]=u=>e.regionSelect&&e.currVideoCanvasSelected?e.Up(u):null)})],2),h("div",{style:{"grid-area":"downZ"},class:Ve(e.regionSelect&&e.currVideoCanvasSelected?"activeInput":"inactiveInput")},[to,no,ao,ie(r,{icon:"arrow-down",onClick:t[11]||(t[11]=u=>e.regionSelect&&e.currVideoCanvasSelected?e.Down(u):null)})],2)]),oo,h("input",{ref:"selectModeRef",onClick:t[12]||(t[12]=()=>{e.dragMode=!e.dragMode,e.dragMode||(e.regionToggleRef.checked=!0),e.regionSelect=!0}),type:"checkbox",class:"sidebar-toggle apple-switch btn btn-default"},null,512)],4),[[rt,e.editMode]]),it(h("div",{id:"loom-menu",style:ee({position:"fixed",width:e.loomMenuWidth,top:"150px",left:"0px"})},[so,h("div",null,[ie(r,{icon:"save",class:"activeInput",onClick:e.saveVideoCanvasState},null,8,["onClick"]),io,ie(r,{icon:"file",class:"activeInput",onClick:e.loadVideoCanvasState},null,8,["onClick"])]),ro,ie(p,{ref:"renderModeRef",modelValue:e.renderMode,"onUpdate:modelValue":t[13]||(t[13]=u=>e.renderMode=u),mode:"single",canDeselect:!1,canClear:!1,options:e.renderModes,onChange:e.onRenderModeChange},null,8,["modelValue","options","onChange"]),lo,ie(p,{ref:"appModeRef",modelValue:e.appMode,"onUpdate:modelValue":t[14]||(t[14]=u=>e.appMode=u),mode:"tags",label:"minLabel",options:e.appModes,searchable:!0,createTag:!0,onChange:e.onAppModeChange,class:"appModeMultiselect"},null,8,["modelValue","options","onChange"])],4),[[rt,e.editMode]]),h("div",co,[(N(!0),G(ze,null,We(e.appModes,(u,b)=>(N(),Ke(i,{key:String(b),id:u.value,ref_for:!0,ref:k=>{k&&(e.appRefs[u.value]=k)},name:u.value,directory:u.directory,videoTargetCache:e.appConfig,regionSelect:e.regionSelect,overlay:e.hintHelpState,renderMode:e.renderMode,dragMode:e.dragMode},null,8,["id","name","directory","videoTargetCache","regionSelect","overlay","renderMode","dragMode"]))),128))])],512)}var fo=ke(va,[["render",uo],["__scopeId","data-v-f826e666"]]);const ho={name:"MainPage",components:{UIBar:an,loomManager:fo},data:function(){return{directory:"https://raw.githubusercontent.com/branson2015/DeRe_Apps/main/RVA",modifier_directory:"https://raw.githubusercontent.com/branson2015/DeRe_Apps/main/demos/demos"}}},go={id:"container"};function po(e,t,n,a,o,l){const r=Ne("u-i-bar"),p=Ne("loom-manager");return N(),G("div",go,[ie(r),ie(p,{directory:e.directory,modifier_directory:e.modifier_directory},null,8,["directory","modifier_directory"])])}var mo=ke(ho,[["render",po],["__scopeId","data-v-3554980e"]]);const vo={components:{MainPage:mo},created(){window.addEventListener("mousemove",e=>{document.body.style.cursor="default",this.emitter.emit("mousemove",e)}),window.addEventListener("mouseup",e=>{document.body.style.cursor="default",this.emitter.emit("mouseup",e)}),window.addEventListener("mousedown",e=>{this.emitter.emit("mousedown",e)})}};function yo(e,t,n,a,o,l){const r=Ne("main-page");return N(),Ke(r)}var xo=ke(vo,[["render",yo]]);Ot.add(At,Vt,Ft,Et,Lt,Nt,Ht,Bt,jt,Ut,zt,Wt,Yt,Xt);const _o=e=>{const t=Kt(e);return t.emitAsync=async function(n,a){let o=this.all.get(n);if(o)for(const l of o)await l(a);if(o=this.all.get("*"),o)for(const l of o)await l(n,a)},t.emit=function(n,a){let o=[],l=this.all.get(n);return l&&(o=o.concat(l.map(r=>r(a)))),l=this.all.get("*"),l&&(o=o.concat(l.map(r=>r(a)))),o},t},vt=_o(),Ze=Jt(xo);Ze.config.globalProperties.emitter=vt;Ze.provide("emitter",vt);Ze.component("font-awesome-icon",qt);Ze.mount("#app");
