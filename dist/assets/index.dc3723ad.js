var xt=Object.defineProperty,_t=Object.defineProperties;var bt=Object.getOwnPropertyDescriptors;var ct=Object.getOwnPropertySymbols;var Ct=Object.prototype.hasOwnProperty,wt=Object.prototype.propertyIsEnumerable;var ut=(e,t,n)=>t in e?xt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,Ae=(e,t)=>{for(var n in t||(t={}))Ct.call(t,n)&&ut(e,n,t[n]);if(ct)for(var n of ct(t))wt.call(t,n)&&ut(e,n,t[n]);return e},ze=(e,t)=>_t(e,bt(t));import{r as b,o as Ke,g as Mt,w as tt,a as H,c as q,b as dt,d as p,n as te,m as nt,t as at,e as ot,F as Ye,f as We,h as ft,i as Xe,j,k as _e,l as St,p as kt,q as st,s as Ge,u as Dt,v as Ne,x as Je,y as ht,P as $t,z as it,A as rt,B as ie,C as Ve,D as It,E as Tt,G as Se,H as Pt,I as Ot,J as Rt,K as At,L as Vt,M as Ft,N as Lt,O as Et,Q as Nt,R as Ht,S as jt,T as Bt,U as Ut,V as zt,W as Yt,X as Wt,Y as Xt,Z as Jt}from"./vendor.f843816d.js";const qt=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))a(o);new MutationObserver(o=>{for(const c of o)if(c.type==="childList")for(const r of c.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&a(r)}).observe(document,{childList:!0,subtree:!0});function n(o){const c={};return o.integrity&&(c.integrity=o.integrity),o.referrerpolicy&&(c.referrerPolicy=o.referrerpolicy),o.crossorigin==="use-credentials"?c.credentials="include":o.crossorigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function a(o){if(o.ep)return;o.ep=!0;const c=n(o);fetch(o.href,c)}};qt();var ke=(e,t)=>{const n=e.__vccOpts||e;for(const[a,o]of t)n[a]=o;return n};const Kt={name:"UIBar",components:{},setup(e,t){let n=null;const a=b([]),o=5,c=dt(),r=function(i){let{order:f,interactions:y}=d(i);f=f.filter(w=>y[w].frames.length>1),f=f.filter((w,M)=>{let k=y[w].frames[y[w].frames.length-1];return!f.slice(0,M).some(X=>k==y[X].frames[y[X].frames.length-1])}),f=f.filter(w=>{let M=y[w].frames[y[w].frames.length-1];return!a.value.some(k=>M==k.id)});for(let w=0,M=0;w<f.length&&M<30;++w){let k=y[f[w]];if(k.n>=o){++M;let X=k.targets[k.targets.length-1],ue=k.vc;a.value=a.value.concat({id:X.id,content:X.name,target:X,vc:ue})}}},d=function(i){let f=i.length,y={};for(let M=0;M<f;++M){let k=[],X="";for(let ue=M;ue<f;++ue){const{id:N}=i[ue],he=i[ue].videoCanvas;k.push(N),X+="-"+String(N),y[X]==null&&(y[X]={frames:[],n:0,vc:he}),y[X].frames=[...k],y[X].targets=y[X].frames.map(Q=>i.find(be=>be.id==Q).target),y[X].n++}}const w=Object.keys(y);return w.sort((M,k)=>y[M].n>y[k].n||y[M].n==y[k].n&&y[M].frames.length>y[k].frames.length?-1:1),{order:w,interactions:y}};return Ke(()=>{n=Mt.GridStack.init({float:!1,cellHeight:"25px",margin:"0.5px",row:1,column:12,minRow:1,resizable:{handles:" "},alwaysShowResizeHandle:/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)}),c.appContext.config.globalProperties.emitter.on("getShortcutItems",()=>a),c.appContext.config.globalProperties.emitter.on("createShortcutItem",i=>a.push(i)),c.appContext.config.globalProperties.emitter.on("runInteractionAnalysis",r)}),tt(a,i=>{n.removeAll(),i.map((f,y)=>ze(Ae({w:1,h:1},f),{id:y})).forEach(f=>{n.addWidget(f).addEventListener("click",w=>{c.appContext.config.globalProperties.emitter.emit(`changeState-${f.vc}`,f.target.id)})})}),{grid:n,items:a,runInteractionAnalysis:r,confidence:o}}},Gt={id:"ui-bar"},Zt=p("div",{class:"grid-stack grid-stack-12"},null,-1),Qt=[Zt];function en(e,t,n,a,o,c){return H(),q("div",Gt,Qt)}var tn=ke(Kt,[["render",en]]);const nn="0.0.7",an={mappings:{loomHover:"loomButton"},spatialTransform:{horizontal_buttons_to_dropdown:!0,vertical_buttons_to_dropdown:!0}};var $e={version:nn,mobile:an};function on(e,t){return e?pt(t,a=>a.hide!=!0&&a.id!="-1"&&(gt(e,a)||e.deactivateOnTransition!==!0&&sn(t,a,e))||a.important):{}}function gt(e,t){return e&&e.hasOwnProperty("children")?Object.keys(e.children).includes(String(t.id)):!1}function sn(e,t,n){return gt(e[n.parent_id],t)}function pt(e,t){const n={};return Object.keys(e).filter(a=>t(e[a])).forEach(a=>n[a]=e[a]),n}function rn(e){const t=[];return Object.keys(e).forEach(n=>t[n]=e[n]),t}function ln(e){const t={};return e.forEach((n,a)=>t[a]=n),t}function cn(e){const t={};return Object.entries(e).forEach(([n,a])=>{t[n]=a}),t}function un(e,t=void 0){const n={};return Object.keys(e).forEach(a=>{e[a]!==Object(e[a])?n[a]=e[a]:t!==void 0&&(n[a]=t)}),n}function qe(e){if(typeof e=="object"&&e!==null)if(e.constructor===Array){const t=[];return e.forEach(n=>{t.push(qe(n))}),t}else{const t={};return Object.entries(e).forEach(([n,a])=>{t[n]=qe(a)}),t}return e}function dn(e,t){const n=qe(e),a=qe(t);return function o(c,r){let d={};return[...new Set(Object.keys(c).concat(Object.keys(r)))].forEach(i=>{r[i]===null||(r[i]===void 0||Object.keys(r[i]).length==0||c[i]!==Object(c[i])||r[i]!==Object(r[i])?d[i]=r[i]!==void 0?r[i]:c[i]:d[i]=o(c[i],r[i]))}),d}(n,a)}function fn(e,t){const n=[];for(let a=0;a<e.rows;a++)for(let o=0;o<e.cols;o++){const c=Array.from(e.ucharPtr(a,o)).slice(0,3),r=Array.from(t.ucharPtr(a,o));c.map((i,f)=>[i,r[f]]).forEach(i=>n.push(Math.abs(i[1]-i[0])))}return n}function hn(e,t){return e.map(n=>({x:n.x*t.x,y:n.y*t.y}))}function gn(e){let t="";t+=`M ${e[0].x} ${e[0].y} `;for(let n=1;n<e.length;++n)t+=`L ${e[n].x} ${e[n].y} `;return t+=`L ${e[0].x} ${e[0].y} `,new Path2D(t)}function pn(e,t,n){t===void 0&&(t=Math.min(...e.map(o=>o.x))),n===void 0&&(n=Math.min(...e.map(o=>o.y)));let a="";return e.forEach((o,c)=>{a+=(o.x-t).toPrecision(4)+","+(o.y-n).toPrecision(4),c!==e.length-1&&(a+=" ")}),a}function mn(e){return[{x:e.x,y:e.y},{x:e.x+e.width,y:e.y},{x:e.x+e.width,y:e.y+e.height},{x:e.x,y:e.y+e.height}]}function vn(e){let t=1/0,n=0,a=1/0,o=0;return e.forEach(c=>{t=Math.min(t,c.x),n=Math.max(n,c.x),a=Math.min(a,c.y),o=Math.max(o,c.y)}),{xmin:t,xmax:n,ymin:a,ymax:o}}function yn(e,t,n){return Math.min(Math.max(t,e),n)}function xn(e,t){return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))}function _n(e){return new Promise(t=>setTimeout(t,e))}function bn(e,t,n=0){let a={};return function(){a[n]||(e.apply(this,arguments),a[n]=!0,setTimeout(function(){delete a[n]},t))}}function Cn(e,t,n){const o=document.elementsFromPoint(t,n).find(d=>d.nodeName=="polygon");if(o===void 0)return null;if(o.isPointInFill){const d=o.getBoundingClientRect(),i=o.parentElement.createSVGPoint();if(i.x=t-d.left,i.y=n-d.top,!o.isPointInFill(i))return null}const c=o.parentElement.parentElement.id,r=e.activeComponents.value[c];return r===void 0||!r.isLoomComponent?null:r}var P={currentTargets:on,objectFilter:pt,arrayToObject:ln,ObjectToArray:rn,shallowCopy:cn,shallowCopyPrimitivesOnly:un,deepCopy:qe,deepMerge:dn,absdiff:fn,scalePolygon:hn,polyToPath2D:gn,polyToPolyString:pn,rectToPoly:mn,boundingBox:vn,bound:yn,dist:xn,sleep:_n,throttle:bn,getComponentFromPoint:Cn};function wn(e,t){if(t.children===void 0)return[];let n=Object.keys(t.children).map(d=>e[d]).filter(d=>Object.keys(d.shape.points).length==4).map(d=>[d]);n.forEach((d,i)=>d[0].group=i);const a=5,o=20,c=5,r=5;for(let d=1;d<n.length;++d)for(let i=0;i<d;++i){const f=n[i].length;for(let y=0;y<f;++y){const w=n[d][0],M=n[i][y];if(!(!w||!M)&&($e.mobile&&$e.mobile.spatialTransform&&$e.mobile.spatialTransform.horizontal_buttons_to_dropdown&&Math.abs(w.shape.dimensions.centerY-M.shape.dimensions.centerY)<=a&&Math.abs(w.shape.dimensions.min_x-M.shape.dimensions.max_x)<=o||$e.mobile&&$e.mobile.spatialTransform&&$e.mobile.spatialTransform.vertical_buttons_to_dropdown&&Math.abs(w.shape.dimensions.min_y-M.shape.dimensions.max_y)<=r&&Math.abs(w.shape.dimensions.centerX-M.shape.dimensions.centerY<=c))){const k=w.group;n[k].forEach(X=>X.group=i),n[i]=n[i].concat(n[k]),n[k]=[]}}}return n=n.filter(d=>d.length>1),n}function Mn(e){const t=(e.max_x-e.min_x)/2,n=Math.max(Math.ceil(Math.pow(t,2/3)),5),a=[];for(let c=0;c<n;++c){const r=2*Math.PI*c/n;a.push({x:Math.sin(r)*t+e.min_x+(e.max_x-e.min_x)/2,y:Math.cos(r)*t+e.min_y+(e.max_y-e.min_y)/2})}const o=ze(Ae({},e),{min_y:e.centerY-t,max_y:e.centerY+t});return[a,o]}function Sn(e,t,n){wn(e,e[n]).forEach(o=>{let c=1/0,r=0,d=1/0,i=0;const f=o.map(()=>({}));for(const k in f)f[k]={},c=Math.min(o[k].shape.dimensions.min_x,c),r=Math.max(o[k].shape.dimensions.max_x,r),d=Math.min(o[k].shape.dimensions.min_y,d),i=Math.max(o[k].shape.dimensions.max_y,i);const y=Object.values(o).map(k=>k.id),w=y.join(),M={actor:"dropdown",type:"linear",name:o.map(k=>k.name).join("-"),id:w,parent:e[n].name||"root",parent_id:e[n].id!==void 0?e[n].id:"-1",children:f,frame_no:-1,child_visit_counter:Object.keys(f).length,shape:{type:"poly",points:{0:{x:c,y:d},1:{x:r,y:d},2:{x:r,y:i},3:{x:c,y:i}},dimensions:{min_x:c,max_x:r,min_y:d,max_y:i}}};y.forEach(k=>t[k]={hide:!0,parent_id:M.id,parent:M.name}),t[w]=M})}function kn(e,t,n){["button","hover"].includes(e[n].actor)&&e[n].shape.points.length==4&&([points,dimensions]=Mn(e[n].shape.dimensions),t[n].shape={points,dimensions})}function Dn(e,t){const n=[];for(n.push("-1");n.length;){const a=n.shift();t[a]!==null&&(Sn(e,t,a),kn(e,t,a),e[a].hasOwnProperty("children")&&t[a]!==null&&n.push(...Object.keys(e[a].children)))}}function $n(e){const t={mode:"mobile"};return Dn(P.shallowCopy(e),t),t}function In(e,t,n){if(n==e.info.mode)return{};let a={};switch(n){case"mobile":a.info={mode:"mobile"},a.data=$n(t);break}return a}const Ze={props:["parent","vcTargetData","targetData","showHint","interactable","current_state","targets"],emits:["changeState","addHistory"],name:"loomComponent",data:function(){return{isLoomComponent:!0,points:null,eventData:{}}},computed:{renderMode(){return this.$parent.renderMode},instanceID(){return this.$parent.instanceID},page(){return this.$parent.page},vcid(){return this.$parent.id},id(){return this.targetData.id},scale(){return this.vcTargetData.scale||{x:1,y:1}},frame(){return this.targetData.frame_no+1},componentID(){return`${this.instanceID}-${this.page}-${this.vcid}-${this.id}`},calcHintStyle(){return{fill:"rgba(246, 230, 80, 0.7)",stroke:"rgba(250, 240, 80, 0.8)","stroke-width":"2"}},calcStyle(){const e=this.targetData;let t="";const n=P.ObjectToArray(e.shape.points),a=P.scalePolygon(n,this.scale),o=e.shape.dimensions.min_x*this.scale.x,c=e.shape.dimensions.min_y*this.scale.y,r=e.shape.dimensions.max_x*this.scale.x,d=e.shape.dimensions.max_y*this.scale.y,i=a.length;return a.forEach((y,w)=>{t+=`${y.x-o},${y.y-c}`,w!==i-1&&(t+=" ")}),this.points=t,{position:"absolute",top:`${parseInt(c)}px`,left:`${parseInt(o)}px`,width:`${parseInt(r-o)}px`,height:`${parseInt(d-c)}px`}}},mounted(){this.$refs.target&&(this.$refs.target.style.display=this.interactable?"block":"none"),this.emitter.emit("addComponent",[this.componentID,this])},beforeUnmount(){this.emitter.emit("removeComponent",this.componentID)},watch:{interactable:function(e){this.$refs.target&&(this.$refs.target.style.display=e?"block":"none")}}};const Tn={name:"loomBrushingBox",mixins:[Ze],data:function(){return{brushing:{state:!1,start_x:0,start_y:0,end_x:0,end_y:0}}},computed:{brushingBoxStyle:function(){return{position:"absolute",visibility:this.brushing.state?"visible":"hidden",top:this.brushing.start_y+"px",left:this.brushing.start_x+"px",width:this.brushing.end_x-this.brushing.start_x+"px",height:this.brushing.end_y-this.brushing.start_y+"px"}}},mounted:function(){this.eventData.mousedown=function(e){let t=e.currentTarget;var n=$(t).offset(),a=e.pageX-n.left,o=e.pageY-n.top;this.brushing.state=!0,this.brushing.start_x=this.brushing.end_x=a,this.brushing.start_y=this.brushing.end_y=o,this.$emit("addHistory",this.targetData,e)}.bind(this),this.eventData.mouseup=function(e){this.brushing.state=!1}.bind(this),this.eventData.mousemove=function(e){if(this.brushing.state==!1)return;const t=e.currentTarget,n=$(t).offset(),a=this.targetData.shape.dimensions.max_x-this.targetData.shape.dimensions.min_x,o=this.targetData.shape.dimensions.max_y-this.targetData.shape.dimensions.min_y;this.brushing.end_x=e.pageX-n.left,this.brushing.end_y=e.pageY-n.top;const c=6,r=a/c,d=o/c,i=Math.round(this.brushing.start_x/r),f=Math.round(this.brushing.start_y/d),y=Math.round((this.brushing.end_x-this.brushing.start_x)/r),M=(Math.round((this.brushing.end_y-this.brushing.start_y)/d)-1)*c**0+y*c**1+f*c**2+i*c**3;this.$emit("changeState",this.targetData.id,M)}.bind(this)}},Pn=["id"],On=["width","height"],Rn=["points"];function An(e,t,n,a,o,c){return H(),q("div",{ref:"target",id:e.componentID,style:te(e.calcStyle)},[e.targetData.shape.type=="poly"?(H(),q("svg",{key:0,width:e.calcStyle.width,height:e.calcStyle.height,style:te([{fill:"transparent","stroke-width":"5"},e.showHint?e.calcHintStyle:{}])},[p("polygon",nt({ref:"polygon"},at(e.eventData),{points:e.points,style:{cursor:"cell"}}),null,16,Rn)],12,On)):ot("",!0),p("div",{id:"brushing-box",ref:"brushing-box",style:te(c.brushingBoxStyle)},null,4)],12,Pn)}var Vn=ke(Tn,[["render",An],["__scopeId","data-v-4c0b568f"]]);const Fn={name:"loomButton",mixins:[Ze],mounted:function(){this.eventData.click=function(e){this.$emit("changeState",this.targetData.id),this.$emit("addHistory",this.targetData,e)}.bind(this)}},Ln=["id"],En=["width","height"],Nn=["points"];function Hn(e,t,n,a,o,c){return H(),q("div",{ref:"target",id:e.componentID,style:te(e.calcStyle)},[e.targetData.shape.type=="poly"?(H(),q("svg",{key:0,width:e.calcStyle.width,height:e.calcStyle.height,style:te([{fill:"transparent","stroke-width":"5"},e.showHint?e.calcHintStyle:{}])},[p("polygon",nt({ref:"polygon"},at(e.eventData),{points:e.points,style:{cursor:"pointer"}}),null,16,Nn)],12,En)):ot("",!0)],12,Ln)}var jn=ke(Fn,[["render",Hn]]);const Bn={name:"loomHover",mixins:[Ze],emits:["onmouseleave"],mounted:function(){this.eventData.mouseover=function(e){this.$emit("changeState",this.targetData.id),this.$emit("addHistory",this.targetData,e)}.bind(this),this.eventData.mouseleave=function(e){this.$emit("onmouseleave")}.bind(this)}},Un=["id"],zn=["width","height"],Yn=["points"];function Wn(e,t,n,a,o,c){return H(),q("div",{ref:"target",id:e.componentID,style:te(e.calcStyle)},[e.targetData.shape.type=="poly"?(H(),q("svg",{key:0,width:e.calcStyle.width,height:e.calcStyle.height,style:te([{fill:"transparent","stroke-width":"5"},e.showHint?e.calcHintStyle:{}])},[p("polygon",nt({ref:"polygon"},at(e.eventData),{points:e.points,style:{cursor:"pointer"}}),null,16,Yn)],12,zn)):ot("",!0)],12,Un)}var Xn=ke(Bn,[["render",Wn]]);const Jn={name:"loomDropdown",mixins:[Ze],methods:{onChange(e){const t=this.targets[Object.keys(this.targetData.children)[e.target.selectedIndex]];this.$emit("changeState",t.id),this.$emit("addHistory",t,e)}},mounted(){this.$nextTick(()=>{this.$refs.dropdown.value=this.$parent.current_state.name})}},qn=["id"];function Kn(e,t,n,a,o,c){return H(),q("select",{ref:"dropdown",id:e.componentID,style:te(e.calcStyle),onChange:t[0]||(t[0]=(...r)=>c.onChange&&c.onChange(...r))},[(H(!0),q(Ye,null,We(Object.keys(e.targetData.children),r=>(H(),q("option",{key:r},ft(e.targets[r].name),1))),128))],44,qn)}var Gn=ke(Jn,[["render",Kn]]);const Zn={name:"USAMap",props:["targetData","vcTargetData"],inject:["manager"],computed:{width(){return this.$parent.targetData.width*this.scale.x},height(){return this.$parent.targetData.height*this.scale.y},scale(){return this.vcTargetData.scale||{x:1,y:1}},calcStyle(){return{position:"absolute",top:"0px",left:"0px",width:`${this.width}px`,height:`${this.height}px`,backgroundColor:"rgba(0,0,0,0.2)",backgroundImage:`url(assets/USA_${this.projectionType}.png)`,backgroundSize:`${this.width}px ${this.height}px`}},stateCenters(){return this.stateCentersTypes[this.projectionType]}},data:function(){return{projectionTypes:["mercator","lambert"],projectionType:null,stateCentersTypes:{mercator:{WA:{x:.084,y:.097},ID:{x:.183,y:.266},MT:{x:.267,y:.115},ND:{x:.425,y:.095},MN:{x:.527,y:.145},MI:{x:.691,y:.27},ME:{x:.958,y:.192},OR:{x:.077,y:.261},WY:{x:.304,y:.286},SD:{x:.427,y:.229},WI:{x:.602,y:.22},NY:{x:.856,y:.295},VT:{x:.895,y:.25},NH:{x:.915,y:.275},MA:{x:.917,y:.314},CT:{x:.892,y:.353},RI:{x:.914,y:.353},CA:{x:.09,y:.526},NV:{x:.142,y:.427},UT:{x:.23,y:.439},CO:{x:.334,y:.457},NE:{x:.431,y:.354},IA:{x:.542,y:.33},IL:{x:.616,y:.411},IN:{x:.664,y:.414},OH:{x:.722,y:.402},PA:{x:.811,y:.384},NJ:{x:.862,y:.425},KS:{x:.455,y:.473},MO:{x:.557,y:.478},KY:{x:.685,y:.511},WV:{x:.762,y:.464},MD:{x:.847,y:.476},DE:{x:.858,y:.455},VA:{x:.801,y:.51},AZ:{x:.23,y:.633},NM:{x:.327,y:.628},TX:{x:.451,y:.743},OK:{x:.477,y:.589},AR:{x:.56,y:.614},TN:{x:.664,y:.578},NC:{x:.785,y:.58},LA:{x:.556,y:.727},MS:{x:.606,y:.69},AL:{x:.657,y:.691},GA:{x:.715,y:.691},SC:{x:.761,y:.651},FL:{x:.741,y:.848}},lambert:{WA:{x:.221,y:.079},ID:{x:.29,y:.241},MT:{x:.377,y:.141},ND:{x:.502,y:.147},MN:{x:.589,y:.203},MI:{x:.742,y:.285},ME:{x:.961,y:.132},OR:{x:.195,y:.203},WY:{x:.391,y:.303},SD:{x:.503,y:.262},WI:{x:.663,y:.253},NY:{x:.891,y:.25},VT:{x:.918,y:.206},NH:{x:.939,y:.212},MA:{x:.939,y:.253},CT:{x:.931,y:.285},RI:{x:.949,y:.282},CA:{x:.173,y:.453},NV:{x:.237,y:.385},UT:{x:.315,y:.429},CO:{x:.412,y:.462},NE:{x:.512,y:.376},IA:{x:.609,y:.359},IL:{x:.675,y:.421},IN:{x:.727,y:.415},OH:{x:.781,y:.391},PA:{x:.859,y:.341},NJ:{x:.914,y:.356},KS:{x:.529,y:.494},MO:{x:.633,y:.503},KY:{x:.747,y:.503},WV:{x:.815,y:.45},MD:{x:.88,y:.397},DE:{x:.901,y:.406},VA:{x:.854,y:.485},AZ:{x:.296,y:.612},NM:{x:.391,y:.629},TX:{x:.508,y:.756},OK:{x:.549,y:.603},AR:{x:.63,y:.629},TN:{x:.734,y:.574},NC:{x:.854,y:.556},LA:{x:.633,y:.768},MS:{x:.68,y:.697},AL:{x:.731,y:.688},GA:{x:.793,y:.691},SC:{x:.835,y:.626},FL:{x:.84,y:.844},AL:{x:.175,y:.821},HI:{x:.414,y:.974}}}}},methods:{getRelativeStateCenters(){const e=this.$refs.target.getBoundingClientRect();return Object.fromEntries(Object.entries(this.stateCenters).map(([t,n])=>[t,{x:n.x*this.width+e.x,y:n.y*this.height+e.y}]))},async getMapping(){return this.manager.regionSelect.value=!1,await this.$nextTick(()=>{const e=Object.fromEntries(Object.entries(this.getRelativeStateCenters()).map(([t,n])=>{const a=P.getComponentFromPoint(this.manager,...Object.values(n));return a===null?null:[t,{mode:a.renderMode,instance:a.instanceID,page:a.page,vcid:a.vcid,frame:a.frame}]}).filter(t=>t!=null));return this.manager.regionSelect.value=!0,e})}},mounted:function(){this.projectionType="lambert"}};function Qn(e,t,n,a,o,c){return H(),q("div",{ref:"target",style:te(c.calcStyle),onClick:t[0]||(t[0]=(...r)=>e.onclick&&e.onclick(...r))},null,4)}var ea=ke(Zn,[["render",Qn]]);const ta={name:"loomVideoCanvas",emits:["frame_processed"],props:["regionSelect","overlay","renderMode","renderAppMode","dragMode","info","targets","targetData","instanceID","start_state_id"],components:{loomButton:jn,loomHover:Xn,loomDropdown:Gn,loomBrushingBox:Vn,loomUSA:ea},setup(e,t){const n=Xe("manager"),a=dt(),o=Xe("emitter"),{loomVideoCanvasRefs:c}=Xe(`instance-${e.instanceID}`),r=n.appRefs[e.instanceID],d=b(100),i=b({x:1,y:1}),f=b(null),y=b(null),w=j(()=>c[M.value]),M=j(()=>e.targetData.id),k=j(()=>e.targetData.page),X=j(()=>e.renderAppMode),ue=j(()=>e.instanceID),N=j(()=>e.targetData.width||e.info.window.width),he=j(()=>N*i.x),Q=j(()=>e.targetData.height||e.info.window.height),be=j(()=>Q*i.y),Fe=j(()=>e.targetData.top||0),He=j(()=>e.targetData.left||0),pe=j(()=>c[e.targetData.parentCanvas]||!1),De=_e({}),Ce=b(-1),ge=b(!1),me=b(!1),U=j(()=>De[V.value]),Ie=j(()=>P.scalePolygon(U.value,i.value)),je=j(()=>P.polyToPolyString(U.value,0,0)),Te=j(()=>P.polyToPolyString(Ie.value,0,0)),V=j(()=>{for(let s=xe.value;s&&s.parent_id!=s.id;s=e.targets[s.parent_id])if(De[s.id])return s.id;return-1}),de=()=>{const s={x:R.value.x-Ee.value.x,y:R.value.y-Ee.value.y},v=i.value;i.value={x:(i.value.x*N.value+s.x)/N.value,y:(i.value.y*Q.value+s.y)/Q.value};const I={x:v.x-i.value.x,y:v.y-i.value.y};e.targetData.scale=i.value;const m=P.boundingBox(U.value);e.targetData.left+=I.x*m.xmin,e.targetData.top+=I.y*m.ymin,re()},Pe=s=>{const v=10,I=Ce.value,m=U.value.length,Y=(I+1)%m,T=((I-1)%m+m)%m;if(P.dist(U.value[I],U.value[Y])<v||P.dist(U.value[I],U.value[T])<v){U.value.splice(I,1),ge.value=!1,re();return}s.x=P.bound(s.x,0,N.value*i.value.x),s.y=P.bound(s.y,0,Q.value*i.value.y),U.value[I]={x:s.x/i.value.x,y:s.y/i.value.y};const W=pe.value;if(!W){re();return}const ee=W.targetData.cutouts,O=ee.findIndex(ae=>ae.id==e.targetData.id);if(O>=0){const ae=ee[O];ae.poly=U.value,ee.splice(O,1,ae)}re()},we=(s,v)=>{U.value.splice(s+1,0,{x:v.x/i.value.x,y:v.y/i.value.y}),ge.value=!0,Ce.value=s+1,re()},Le=s=>{if(!e.regionSelect)return-1;const v=2,m=Math.ceil(8/2+v/2);return Ie.value.map(T=>{let W=0,ee=0;m>T.x?W=-(T.x-m):he.value<T.x+m&&(W=he.value-(T.x+m)),m>T.y?ee=-(T.y-m):be.value<T.y+m&&(ee=be.value-(T.y+m));const O=[{x:T.x+W-m,y:T.y+ee-m},{x:T.x+W+m,y:T.y+ee-m},{x:T.x+W+m,y:T.y+ee+m},{x:T.x+W-m,y:T.y+ee+m}];return P.polyToPath2D(O)}).findIndex(T=>Z.value.isPointInPath(T,s.x,s.y))},Oe=s=>e.regionSelect?Ie.value.map((I,m,Y)=>{const T=(m+1)%Y.length,W=Y[T];return P.polyToPath2D([I,W])}).findIndex(I=>Z.value.isPointInStroke(I,s.x,s.y)):-1,K=(s,v)=>{const I="#ff0000",m=2,Y=8;s.lineWidth=m,s.strokeStyle=I;let T=function(W,ee){const O=Math.ceil(Y/2+m/2);s.strokeRect(P.bound(W,O,N.value-O)-O,P.bound(ee,O,Q.value-O)-O,Y,Y)}.bind(w.value);s.beginPath(),s.moveTo(P.bound(v[0].x,m/2,N.value-m/2),P.bound(v[0].y,m/2,Q.value-m/2));for(let W=1;W<v.length;++W)s.lineTo(P.bound(v[W].x,m/2,N.value-m/2),P.bound(v[W].y,m/2,Q.value-m/2));s.closePath(),s.stroke(),v.forEach(W=>T(W.x,W.y))},F=b({x:0,y:0}),L=b({x:0,y:0}),Ee=b({x:0,y:0}),R=b({x:0,y:0}),ve=b(!1),l=b(!1),{dragMode:h}=St(e),_=j(()=>{const s=Math.min(F.value.y,L.value.y)+"px",v=Math.min(F.value.x,L.value.x)+"px",I=Math.abs(L.value.x-F.value.x)+"px",m=Math.abs(L.value.y-F.value.y)+"px";return{position:"absolute",display:oe.value?"block":"none","background-color":"rgba(0, 0, 0, 0.5)","border-style":"dashed","pointer-events":"none",top:s,left:v,width:I,height:m}});tt(h,s=>{re()});const D=s=>{const{left:v,top:I}=f.value.getBoundingClientRect();return{x:s.clientX-v-e.targetData.left,y:s.clientY-I-e.targetData.top}},x=s=>{if(Ee.value=R.value,R.value=D(s),ge.value){Pe(R.value);return}else if(me.value&&e.targetData.resizeable!==!1){de();return}else(!h.value&&e.targetData.reshapeable!==!1||e.targetData.resizeable!==!1)&&(Le(R.value)>=0?document.body.style.cursor="move":Oe(R.value)>=0&&(document.body.style.cursor="crosshair"));!ve.value||!l.value||e.targetData.movable!==!1&&(L.value=R.value,h.value&&(e.targetData.top+=s.movementY,e.targetData.left+=s.movementX))},E=s=>{const v=D(s),I=s.shiftKey;if(e.targetData.reshapeable!==!1||e.targetData.resizeable!==!1){const m=Le(v);if(m>=0&&!h.value&&(I&&e.targetData.resizeable!==!1?me.value=!0:e.targetData.reshapeable!==!1&&(me.value=!1,ge.value=!0,Ce.value=m)),m<0&&e.targetData.reshapeable!==!1){const Y=Oe(v);Y>=0&&(we(Y,v),re())}}},G=s=>(document.body.style.cursor="default",ve.value=!0,R.value=D(s),h.value?L.value=F.value={x:-1e4,y:-1e4}:L.value=F.value=R.value,o.emit("deselect"),ve.value=!0,o.emit("selectVideoCanvas",w.value),l.value=e.regionSelect,!1),C=s=>{l.value=!1,ve.value=!1,me.value=!1,ge.value=!1,document.body.style.cursor="default"},ye=()=>{l.value=!1,F.value=L.value={x:-1e4,y:-1e4}},Re=()=>{ve.value=!1},oe=j(()=>!(h.value||!e.regionSelect||F.value.x==-1e4||F.value.y==-1e4||L.value.x==-1e4||L.value.y==-1e4||Math.abs(L.value.x-F.value.x)<5||Math.abs(L.value.y-F.value.y)<5));tt(oe,s=>{o.emit("regionExists",{exists:s,origin:w.value})});const le=()=>{F.value.x>L.value.x&&([F.value.x,L.value.x]=[L.value.x,F.value.x]),F.value.y>L.value.y&&([F.value.y,L.value.y]=[L.value.y,F.value.y]),se(P.rectToPoly({x:F.value.x,y:F.value.y,width:L.value.x-F.value.x,height:L.value.y-F.value.y})),F.value=L.value={x:-1e4,y:-1e4}},ne=(s,v=!0)=>{se(s,!1,v)},se=(s,v=!0,I=!0)=>{if(s.length>0&&!e.targetData.parentCanvas){r.newVideoTarget({parentCanvas:e.targetData.id,startupFn:m=>{m.cutRegions(s,v,I),m.emitter.emit("deselect"),delete m.targetData.startupFn},processed:!0});return}s.length>0&&s[0].constructor!==Array&&(s=[s]),s.forEach(m=>{const Y=String(Object.keys(r.currentVideoTargets).length);r.currentVideoTargets[Y]={page:e.targetData.page,id:Y,current_state_id:xe.value.id,region:m,top:e.targetData.top,left:e.targetData.left,makeCutout:v,parentCanvas:e.targetData.id,cutouts:[],startupFn:T=>{T.emitter.emit("deselect"),delete T.targetData.startupFn},processed:!0}})},Z=b(null),re=(s=!1)=>{o.emit("changeVideoFrame",[e.instanceID,k.value,M.value,g.value,s])},Me=(s,v=!0)=>{if(!(S.value||!s)){if(Z.value.restore(),Z.value.save(),Z.value.fillStyle="rgba(0, 0, 0, 0)",Z.value.clearRect(0,0,N.value,Q.value),e.targetData.drawImage!==!1){const I=s.videoWidth/s.clientWidth,m=s.videoHeight/s.clientHeight;Z.value.drawImage(s,0,0,N.value*I,Q.value*m,0,0,N.value,Q.value)}!h.value&&U.value&&K(Z.value,U.value),v&&o.emit("post_redraw"+e.targetData.id),u(),S.value=!0,setTimeout(()=>S.value=!1,20)}},u=()=>{if(e.targetData.processed||!y.value)return;const s=cv.imread(y.value);cv.cvtColor(s,s,cv.COLOR_RGBA2GRAY,0),cv.threshold(s,s,254,255,cv.THRESH_BINARY);const v=new cv.MatVector,I=new cv.Mat;cv.findContours(s,v,I,cv.RETR_TREE,cv.CHAIN_APPROX_SIMPLE);const m=[],Y=Array.from(I.data32S);for(;Y.length>0;)m.push(Y.splice(0,4));const T=[];m.forEach((O,ae)=>{O[2]!=-1&&O[3]==-1&&T.push(ae)});function W(O,ae){const Be={left:O.x,top:O.y,right:O.x+O.width,bottom:O.y+O.height},Ue={left:ae.x,top:ae.y,right:ae.x+ae.width,bottom:ae.y+ae.height};return!(Ue.left>Be.right||Ue.right<Be.left||Ue.top>Be.bottom||Ue.bottom<Be.top)}const ee=T.filter(O=>cv.contourArea(v.get(parseInt(O)),!1)>1e3).map(O=>cv.boundingRect(v.get(parseInt(O)))).sort((O,ae)=>O.width*O.height>ae.width*ae.height).filter((O,ae,Be)=>!Be.slice(ae+1).some(Ue=>W(Ue,O))).filter(O=>Math.abs(N.value-O.width)>100&&Math.abs(Q.value-O.height)>100).map(P.rectToPoly);ee.length!=0&&se(ee,!0,!0),s.delete(),v.delete(),I.delete(),t.emit("frame_processed")},g=b(null),S=b(!1),J=b(!0),B=(s,v=0,I=!0,m=!0)=>{z(e.targets[s].frame_no,v,I,m)},z=(s,v=0,I=!0,m=!0)=>{const Y=s+1+v;if(g.value==Y)return;o.emit("changeVideoFrame",[e.instanceID,k.value,M.value,g.value,Y,m])[0].some(ee=>ee.instance==ue.value&&ee.page==k.value&&ee.vcid==M.value)&&(g.value=Y,I&&J.value&&r.changeStateWithFrameNo(s,v),e.targetData.current_state_id=Object.values(e.targets).find(ee=>ee.frame_no==s).id)},ce=(s,v)=>{r.updateInteractionHistory(s,v,e.targetData.id)},fe=_e({}),xe=j(()=>Object.values(e.targets).find(s=>s.id==e.targetData.current_state_id)||Object.values(e.targets).sort((s,v)=>s.frame_no-v.frame_no)[0]),et=j(()=>P.currentTargets(xe.value,e.targets)),yt=s=>{if(s.id=="-1")return;const v=`loom${s.actor.charAt(0).toUpperCase()+s.actor.slice(1)}`;if($e[e.renderAppMode]&&$e[e.renderAppMode].mappings){const I=$e[e.renderAppMode].mappings[v];if(I&&a.components[I])return a.components[I]}if(a.components[v])return a.components[v]};Ke(()=>{if(Z.value=y.value.getContext("2d"),Z.value.save(),k.value==r.currentPage&&e.start_state_id!==void 0&&(e.targetData.current_state_id=e.start_state_id),xe.value!==void 0&&(B(xe.value.id,0,!1),e.targetData.region?De[V.value]=e.targetData.region:De[V.value]=[{x:0,y:0},{x:N.value,y:0},{x:N.value,y:Q.value},{x:0,y:Q.value}],e.targetData.makeCutout&&r)){const s=U.value,v=Math.min(...s.map(T=>T.x)),I=Math.max(...s.map(T=>T.x)),m=Math.min(...s.map(T=>T.y)),Y=Math.max(...s.map(T=>T.y));pe.value&&pe.value.targetData.cutouts.push({poly:U.value,width:I-v,height:Y-m,top:m,left:v,id:e.targetData.id})}e.targetData.startupFn&&e.targetData.startupFn(w.value),o.on("clearSelection",ye),o.on("deselect",Re),o.on(`changeState-${e.targetData.id}`,B),o.on("mousemove",x),o.on("mouseup",C),o.on("mousedown",E),ve.value=!0,o.emit("selectVideoCanvas",w.value)}),kt(()=>{if(pe.value&&pe.value.targetData){const s=pe.value.targetData.cutouts.findIndex(v=>v.id===e.targetData.id);s>=0&&pe.value.targetData.cutouts.splice(s,1)}o.off("clearSelection",ye),o.off("deselect",Re),o.off(`changeState-${e.targetData.id}`,B),o.off("mousemove",x),o.off("mouseup",C),o.off("mousedown",E)});const lt={utils:P,zIndex:d,selected:ve,dragStart:F,dragCurr:L,lastMouseLoc:Ee,mouseLoc:R,dragging:l,reshapePolygonMode:ge,resizePolygonMode:me,ctx:Z,polygonMasks:De,polygonReshapeIdx:Ce,updateParentCurrentState:J,lastFrame:g,throttle:S,dragMode:h,scale:i,loomVideoCanvasRefs:c,componentRefs:fe,instanceRef:r,canvasRef:y,containerRef:f,current_state:xe,currentTargets:et,id:M,page:k,mode:X,instance:ue,width:N,scaledWidth:he,height:Q,scaledHeight:be,top:Fe,left:He,parentCanvasRef:pe,currentPolygonMaskID:V,currentPolygonMask:U,currentPolygonMaskScaled:Ie,currentPolygonMaskString:je,currentPolygonMaskStringScaled:Te,regionExists:oe,dragSelectStyle:_,getComponent:yt,changeState:B,changeStateWithFrameNo:z,addHistory:ce,cutSelectedRegion:le,copyRegions:ne,cutRegions:se,resizePolygon:de,reshapePolygon:Pe,addNewVertex:we,isPolygonVertexHovered:Le,isPolygonLineHovered:Oe,clientToOffset:D,onScreenMouseMove:x,onScreenMouseDown:E,onVideoMouseDown:G,onScreenMouseUp:C,drawPolyOutline:K,redraw:re,draw:Me,processFrame:u,clearSelection:ye,deselect:Re};return st(`videoCanvas-${M}`,lt),lt}},na={"pointer-events":"none"},aa=["id"],oa=["points"],sa=["width","height"],ia={class:"offset",style:{position:"absolute",top:"0px",left:"0px"}},ra=["width","height"],la=["points"];function ca(e,t,n,a,o,c){return H(),q("div",{ref:"containerRef",style:te([{height:"0px",width:"0px","pointer-events":"auto"},{zIndex:e.zIndex}])},[(H(),q("svg",na,[p("clipPath",{id:`clipping-${n.instanceID}-${n.targetData.id}`},[p("polygon",{"pointer-events":"fill",points:e.currentPolygonMask?e.currentPolygonMaskStringScaled:null},null,8,oa)],8,aa)])),p("div",{style:te({position:"absolute",top:e.top+"px",left:e.left+"px",clipPath:`url(#clipping-${n.instanceID}-${e.id})`}),onClick:t[0]||(t[0]=r=>{e.dragging=!1,e.emitter.emit("clickVideoCanvas",r)}),onMousedown:t[1]||(t[1]=(...r)=>e.onVideoMouseDown&&e.onVideoMouseDown(...r)),onMouseleave:t[2]||(t[2]=r=>e.dragging=!1)},[p("div",null,[p("canvas",{ref:"canvasRef",width:e.width,height:e.height,style:te({width:(e.width*e.scale.x).toPrecision(4)+"px",height:(e.height*e.scale.y).toPrecision(4)+"px",zIndex:e.zIndex})},null,12,sa),p("div",{style:te(e.dragSelectStyle)},null,4),p("div",{class:"overlay",style:te([{display:n.overlay?"block":"none"},{position:"absolute",top:"0px",left:"0px",width:"100%",height:"100%","background-color":"rgba(0, 0, 0, 0.5)"}])},null,4)]),p("div",ia,[(H(!0),q(Ye,null,We(e.currentTargets,r=>(H(),Ge(Dt(e.getComponent(r)),{key:r.id,ref_for:!0,ref:d=>{d&&(e.componentRefs[r.id]=d)},targetData:r,vcTargetData:n.targetData,targets:n.targets,showHint:n.overlay,interactable:!n.regionSelect,onChangeState:e.changeState,onAddHistory:e.addHistory},null,8,["targetData","vcTargetData","targets","showHint","interactable","onChangeState","onAddHistory"]))),128))]),(H(!0),q(Ye,null,We(n.targetData.cutouts,(r,d)=>(H(),q("svg",{key:d,width:(e.width*e.scale.x).toPrecision(4),height:(e.height*e.scale.y).toPrecision(4),style:te({width:(e.width*e.scale.x).toPrecision(4),height:(e.height*e.scale.y).toPrecision(4),top:"0px",left:"0px",position:"absolute",fill:"black"}),"pointer-events":"none"},[p("polygon",{"pointer-events":"fill",points:e.utils.polyToPolyString(e.utils.scalePolygon(r.poly,e.scale),0,0)},null,8,la)],12,ra))),128))],36)],4)}var ua=ke(ta,[["render",ca]]);const da={name:"LoomInstance",components:{loomVideoCanvas:ua},props:{config_filename:{type:String,default:"config.json"},vtc_filename:{type:String,default:"vtc.json"},renderMode:String,videoTargetCache:{type:Object,default:{}},video_filename:{type:String,default:"video.mp4"},directory:String,regionSelect:Boolean,overlay:Boolean,dragMode:Boolean,id:String,name:String},setup(e,t){const n=Xe("emitter"),{appConfig:a,linkData:o,appRefs:c}=Xe("manager"),r=b(!1),d=b(null),i=b(null),f=b(null),y=l=>{const h={id:l,promises:[]};ge.push(h),Je(()=>{const _=w(U[l]);_?h.player=_:console.error("No Player!")})},w=l=>{const h=ht.getPlayer(l);if(h)return h;const _={sources:[{src:e.directory+"/"+e.video_filename,type:"video/mp4"}],controls:!1,loadingSpinner:!1,controlBar:!1};return ht(l,_,function(){this.on("click",function(D){D.preventDefault()})})},M=()=>r.value?Promise.resolve([i,a.value]):Promise.all([fetch(e.directory+"/"+e.config_filename).then(l=>l.text()).then(l=>JSON.parse(l)).catch(l=>null),fetch(e.directory+"/"+e.vtc_filename).then(l=>l.text()).then(l=>JSON.parse(l)).catch(l=>null)]).then(([l,h])=>{if(console.log(l,h),h||(h=a.value),l.info.version!=$e.version){console.error("ERROR, out of version config file, run Recorder/convert.py");return}return i.value=l,f.value=i.value.hasOwnProperty(d.value)?i.value[d.value]:i.value.original,r.value=!0,de.hidden={},e.videoTargetCache.hidden={},de.original=i.value.original.data,[i,h]}),k=l=>{d.value=`${l.value}_${l.renderMode}`,M().then(([h,_])=>{l.selected||(d.value="hidden"),He(d.value,l.renderMode),X(_,l.value,l.renderMode),ue(d.value),N.value=Object.values(Te.value).filter(x=>x.frame_no>0).sort((x,E)=>x.frame_no-E.frame_no)[1],be(N.value.id);const D=Object.values(o.linkedCanvases.sets).find(x=>x.data.instance==e.id);if(D){const x=D.data;n.emit("changeVideoFrame",[x.instance,x.page,x.vcid,-1,x.frame,!1])}})},X=(l,h,_)=>{const D=`${h}_${_}`;if(!l||l[D]===void 0)return;const x=l[D],E=P.deepCopy(x);for(const G of Object.values(E))for(const C of Object.values(G)){C.processed=C.processed===void 0?Boolean(C.cutouts&&C.cutouts.length>0):C.processed,C.cutouts=C.cutouts||[];const ye=h,Re=C.linkedFrames||[];for(const oe of Re){const le={mode:_,instance:ye,page:C.page,vcid:C.id};for(const ne of oe.frames){const se=ze(Ae({},le),{frame:ne[0]}),Z=ze(Ae({},oe),{frame:ne[1]}),re=`${se.instance}_${se.page}_${se.vcid}_${se.frame}`,Me=`${Z.instance}_${Z.page}_${Z.vcid}_${Z.frame}`;o.linkedCanvases.exists(re)||o.linkedCanvases.add(re,se),o.linkedCanvases.exists(Me)||o.linkedCanvases.add(Me,Z),o.linkedCanvases.merge(re,Me)}}if(C.parentCanvas&&C.parentCanvas!="-1"){const oe=V[C.parentCanvas];if(C.makeCutout&&oe){oe.targetData.cutouts=C.parentCanvas.cutouts||[];const le=C.region,ne=Math.min(...le.map(u=>u.x)),se=Math.max(...le.map(u=>u.x)),Z=Math.min(...le.map(u=>u.y)),re=Math.max(...le.map(u=>u.y));oe.targetData.cutouts.push({poly:le,width:se-ne,height:re-Z,top:Z,left:ne,id:C.id})}}}for(let G in x)e.videoTargetCache[D][G]=x[G]},ue=l=>{e.videoTargetCache.hasOwnProperty(l)||Oe({processed:!1},l)},N=b(null),he=_e([]),Q=b(30),be=(l,h=0)=>{const _=Te.value[l];if(_===void 0){console.error("Invalid state");return}Fe(_.frame_no)},Fe=l=>{N.value=Object.values(Te.value).find(h=>h.frame_no==l)},He=(l,h)=>{de.hasOwnProperty(l)||(i.value.hasOwnProperty(l)||(i.value[l]=In(i.value,de.original,h)),de[l]=i.value[l].data||{})},pe=(l,h,_)=>{const D={id:l.id,videoCanvas:_,target:l,event:h};he.push(D),he.length>Q.value&&he.shift(),n.emit("runInteractionAnalysis",he)},De=b(30),Ce=b(3),ge=_e([]),me=b(0),U=_e({}),Ie=(l,h,_,D=!0)=>{if(!_&&_!==0){V[h].draw(null,D);return}const x=ge[me.value];me.value=(me.value+1)%Ce.value,new Promise((E,G)=>{x.promises.push(E),x.inUse||E(E),setTimeout(()=>G(E),1e3)}).then(E=>{const G=x.promises.findIndex(C=>C==E);x.player.on("timeupdate",function C(){const ye=U[x.id];!ye||(V[h]&&V[h].draw(ye,D),x.player.off("timeupdate",C),x.promises[G+1]&&x.promises[G+1](x.promises[G+1]),x.inUse=!1,x.promises.splice(G,1))}),x.inUse=!0,x.player.currentTime(_/De.value)}).catch(E=>{const G=x.promises.findIndex(C=>C==E);x.promises.splice(G,1),console.warn("frame took too long")})},je=(l,h)=>{const _=c[l.instance].renderAppMode;e.videoTargetCache[_][l.page][l.vcid].linkedFrames==null&&(e.videoTargetCache[_][l.page][l.vcid].linkedFrames=[]);const D=e.videoTargetCache[_][l.page][l.vcid].linkedFrames,x=D.find(E=>E.mode==h.mode&&E.page==h.page&&E.vcid==h.vcid);if(x!=null)x.frames=x.frames||[],x.frames.push([l.frame,h.frame]);else{const E=Ae({},h);l.instance!=h.instance&&(delete E.frame,E.frames=[[l.frame,h.frame]]),D.push(E)}},Te=j(()=>{const l=P.shallowCopy(de.original);delete l.mode;const h=P.shallowCopy(de[d.value]||{});return delete h.mode,P.deepMerge(l,h)}),V=_e({}),de=_e({}),Pe=j(()=>{if(!N.value||!e.videoTargetCache[d.value])return[null,null];let l=null,h="-1";for(let _=N.value;l===null&&_&&_.id!=_.parent_id;_=Te.value[_.parent_id]){if(typeof _.frame_no=="string"&&_.frame_no.includes("frameless"))continue;const D=Object.entries(e.videoTargetCache[d.value]);for(let x=0;x<D.length;++x)if(String(_.id)===D[x][0]){l=D[x][1],h=D[x][0];break}}return l===null&&(l=e.videoTargetCache[d.value]["-1"]),[h,l]}),we=j(()=>Pe.value[1]),Le=j(()=>Pe.value[0]),Oe=async(l={},h=void 0,_=!1)=>{h===void 0&&(h=d.value);let D="-1",x=0;e.videoTargetCache.hasOwnProperty(h)?(l.newPageFromRoot===!1?D=Le.value:D=String(N.value.id),x=D):e.videoTargetCache[h]={};const E=P.rectToPoly({x:0,y:0,width:i.value.info.window.width,height:i.value.info.window.height});(!e.videoTargetCache[h][D]||_)&&(e.videoTargetCache[h][D]={});const G=String(Object.keys(e.videoTargetCache[h][D]).length);return e.videoTargetCache[h][D][G]=Ae({page:D,id:G,current_state_id:x,region:E,top:0,left:0,makeCutout:!1,parentCanvas:!1,cutouts:[],startupFn:null,processed:!0},l),await Je(()=>V[G])},K=async(l,h,_)=>{delete e.videoTargetCache[l][h][_]},F=l=>{l.zIndex++},L=l=>{l.zIndex--},Ee=l=>{let h=null;l===null&&we.value!==null?h="-1":l&&(h=l.id),h!==null&&delete we.value[h]},R=l=>{if(!l)return;const h=l.startupFn,_=P.deepCopy(l);for(_.startupFn=D=>{D.updateParentCurrentState=!1,h&&h(D)},_.id="0";we.value[_.id]!==void 0;)_.id=String(parseInt(_.id)+1);we.value[_.id]=_};Ke(l=>{for(let h=0;h<Ce.value;++h)y(h)});const ve={config:i,currentConfig:f,current_state:N,loaded:r,renderAppMode:d,transformedTargetCache:de,videoPlayers:ge,interactionHistory:he,maxHistoryLength:Q,numVideoPlayers:Ce,lastUsedVideoPlayer:me,targets:Te,computeCurrentVideoTargets:Pe,currentVideoTargets:we,currentPage:Le,setupVideo:w,load:M,init:k,init_videoTargetCache:X,updateInteractionHistory:pe,addInstanceLink:je,changeState:be,changeStateWithFrameNo:Fe,targetCacheModeChange:He,newVideoTarget:Oe,destroyVideoTarget:K,changeVideoFrame:Ie,createNewVideoPlayer:y,videoCacheModeChange:ue,Up:F,Down:L,Delete:Ee,paste:R,loomVideoCanvasRefs:V,videoPlayerRefs:U};return st(`instance-${e.id}`,ve),ve}};function fa(e,t,n,a,o,c){const r=Ne("loom-video-canvas");return H(),q("div",{id:"loom",style:te({height:e.config?e.config.info.window.height+"px":"0px",width:e.config?e.config.info.window.width+"px":"0px",position:"absolute","margin-left":"auto","margin-right":"auto",left:0,right:0,"text-align":"center","pointer-events":"none"})},[(H(!0),q(Ye,null,We(e.videoPlayers,(d,i)=>(H(),q("video",{key:i,ref_for:!0,ref:f=>{f&&(e.videoPlayerRefs[d.id]=f)},style:te([{width:e.config?e.config.info.window.width+"px":"0px",height:e.config?e.config.info.window.height+"px":"0px"},{position:"absolute",top:"0px",left:"0px",visibility:"hidden"}]),class:"video-js",crossorigin:"anonymous"},null,4))),128)),(H(!0),q(Ye,null,We(e.currentVideoTargets,d=>(H(),Ge(r,{key:`${e.renderAppMode}-${d.page}-${d.id}`,ref_for:!0,ref:i=>{i&&(e.loomVideoCanvasRefs[d.id]=i)},instanceID:n.id,targets:d.targets||e.targets,targetData:d,start_state_id:e.current_state.id,regionSelect:n.regionSelect,overlay:n.overlay,renderMode:n.renderMode,renderAppMode:e.renderAppMode,currentConfig:e.currentConfig,info:e.config.info,dragMode:n.dragMode,onFrame_processed:()=>d.processed=!0},null,8,["instanceID","targets","targetData","start_state_id","regionSelect","overlay","renderMode","renderAppMode","currentConfig","info","dragMode","onFrame_processed"]))),128))],4)}var ha=ke(da,[["render",fa],["__scopeId","data-v-a8994c1a"]]);function ga(e,t=0,n=-1){this.rank=t,this.parent=n,this.data=e,this.children=[]}function mt(){this.sets={},this.nsets=0}mt.prototype={add(e=void 0,t=void 0){return e==null&&(e=this.sets.length),this.sets.hasOwnProperty(e)?null:(this.sets[e]=new ga(t),this.sets[e].children.push(e),++this.nsets,e)},find(e){return this.sets[e]?this.sets[e].parent==-1?e:(this.sets[e].parent=this.find(this.sets[e].parent),this.sets[e].parent):null},transferChildren(e,t){const n=this.sets[e],a=this.sets[t];a.children=a.children.concat(n.children),n.children=[]},merge(e,t){if(e=this.find(e),t=this.find(t),e==null||t==null)return null;if(e!=t){const n=this.sets[e],a=this.sets[t];n.rank>a.rank?(a.parent=e,this.transferChildren(t,e)):n.rank<a.rank?(n.parent=t,this.transferChildren(e,t)):(a.parent=e,++n.rank,this.transferChildren(t,e)),--this.nsets}return this.find(e)},of(e){return this.sets[this.find(e)].children.map(t=>this.sets[t].data)},connected(e,t){return this.find(e)===this.find(t)},at(e){return this.sets[e].data},exists(e){return this.sets.hasOwnProperty(e)},size(){return this.nsets}};const pa={components:{loomInstance:ha,Multiselect:$t},props:["directory","modifier_directory"],setup(e,t){const n=b(null),a=b(null),o=b(null),c=b(!1),r=b(null),d=b(120),i=b(!1),f=b(!0),y=b(!1),w=b(null),M=b(null),k=()=>{i.value=!i.value,o.value.checked=!1,c.value=!1,a.value.checked=!1,f.value=!0},X=()=>{c.value=!c.value,r.value.checked=!1,i.value=!1},ue=u=>{le.value=u,se()},N=u=>{oe.value=u,se()},he=()=>{C[V.value.instanceID]&&C[V.value.instanceID].Up(V.value)},Q=()=>{C[V.value.instanceID]&&C[V.value.instanceID].Down(V.value)},be=()=>{C[V.value.instanceID]&&C[V.value.instanceID].Delete(V.value)},Fe=()=>{M.value=V.value},He=()=>{Fe(),be()},pe=()=>{const u=M.value;Fe(),De(),M.value=u},De=()=>{if(C[M.value.instanceID]){const u=P.deepCopy(M.value.targetData);u.makeCutout=!1,C[M.value.instanceID].paste(u)}},Ce=()=>{let u="None";ne.value.startState&&ne.value.startState.saveName&&(u=ne.value.startState.saveName);let g=prompt(`Enter name to save config as: (default: ${u})`);if(!g){if(!u||u=="None")return;g=u}const S=new Set(JSON.parse(localStorage.getItem("saveNames")))||new Set;S.has(g)&&!confirm("Name already taken")||(S.add(g),ne.value.startState={saveName:g,appMode:oe.value},Je(()=>{try{localStorage.setItem("saveNames",JSON.stringify([...S])),localStorage.setItem(g,JSON.stringify(ne.value))}catch(J){alert(`Could not save to localStorage: ${String(J)}`),console.error(J)}}))},ge=u=>{let g=new Set(D.value.map(B=>B.split(".")[0])),S=localStorage.getItem("saveNames");if(S&&(S=JSON.parse(S),S.forEach(B=>g.add(B))),!g)return alert("No files to load"),!1;g=Array.from(g);function J(B){if(ne.value=B,ne.value.startState&&ne.value.startState.appMode){const z=ne.value.startState.appMode;z.forEach(ce=>{const fe=e.directory+"/"+ce,xe=fe.split("/").filter(et=>et!="").slice(-1)[0].replaceAll(" ","_");ye.push({directory:fe,label:xe.charAt(0).toUpperCase()+xe.slice(1),minLabel:(xe.charAt(0).toUpperCase()+xe.slice(1)).substr(0,4)+"...",value:xe})}),oe.value=z.map(ce=>ce.split().join("_"))}Je(se)}if(u===void 0&&(u=prompt(`Enter file (blank to upload)
 Available names: `+g.join(", "))),u==="")me().then(B=>{const z=new FileReader;z.onload=ce=>{J(JSON.parse(ce.target.result)),Ce()},z.readAsText(B)});else if(g.some(B=>B==u)){const B=g.indexOf(u),z=_.value[B];return J(z||JSON.parse(localStorage.getItem(u))),!0}else return alert("File does not exist"),!1};function me(){return new Promise(u=>{let g=document.createElement("input");g.type="file",g.onchange=S=>{let J=Array.from(g.files);u(J[0])},g.click()})}const U=b([]),Ie=([u,g])=>{U.value[u]=g},je=u=>{delete U[u]},Te=u=>P.getComponentFromPoint(Me,u.x,u.y),V=b(null),de=u=>{K.linkMode!=="selectable"&&(i.value=!1,Je(()=>{const g=Te(u);if(K.linkMode==="linkingFrom")K.firstLink=F(V.value,g),K.linkMode="linkingTo";else if(K.linkMode==="linkingTo"){const S=F(V.value,g);L(K.firstLink,S),K.linkMode="selectable"}i.value=!0}))},Pe=async(u=null,g=void 0,S=!0)=>{if(C[V.value.instanceID])return await C[V.value.instanceID].newVideoTarget(u,g,S)},we=u=>{C[u.instanceID].destroyVideoTarget(u.mode,u.page,u.id)},Le=()=>{f.value=!0,a.value.checked=!1,w.value.cutSelectedRegion()},Oe=(u,g,S,J,B,z)=>{if(K.linkedCanvases.exists(`${u}_${g}_${S}_${B}`)){const ce=[];return K.linkedCanvases.of(`${u}_${g}_${S}_${B}`).forEach(fe=>{fe.componentID===void 0&&C[fe.instance]&&(C[fe.instance].changeVideoFrame(fe.page,fe.vcid,fe.frame,z),ce.push({instance:fe.instance,page:fe.page,vcid:fe.vcid}))}),ce}else{const ce=[];return C[u]&&(C[u].changeVideoFrame(g,S,B,z),ce.push({instance:u,page:g,vcid:S})),ce}},K=_e({linkMode:"selectable",firstLink:null,linkedCanvases:new mt}),F=(u,g)=>{let S=null;return g==null?S={mode:u.renderMode.value,instance:u.instanceID,page:u.page,vcid:u.id,frame:u.lastFrame}:S={mode:u.renderMode.value,instance:u.instanceID,page:u.page,vcid:u.id,frame:g.frame,componentID:g.componentID},S},L=(u,g)=>{let S,J;J=`${u.instance}_${u.page}_${u.vcid}_${u.frame}`,S=`${g.instance}_${g.page}_${g.vcid}_${g.frame}`,K.linkedCanvases.exists(J)||K.linkedCanvases.add(J,u),K.linkedCanvases.exists(S)||K.linkedCanvases.add(S,g),K.linkedCanvases.merge(J,S),V.value.instanceRef.addInstanceLink(u,g),K.firstLink=null},Ee=j(()=>({none:{color:"grey",cursor:"default"},selectable:{color:"white",cursor:"pointer"},linkingFrom:{color:"green",cursor:"pointer"},linkingTo:{color:"red",cursor:"pointer"}})[K.linkMode]),R=_e({mapLinkMode:"selectable",firstLink:null,mapComponent:null}),ve=async u=>{const g=()=>{R.mapComponent!=null&&we(R.mapComponent.$parent),R.mapLinkMode="selectable",R.firstLink=null,R.mapComponent=null};if(R.mapLinkMode=="selectable"){if(R.mapComponent!=null)return;R.mapComponent=(await l()).componentRefs["0"],R.mapLinkMode="linkingFrom"}else if(R.mapLinkMode=="linkingFrom")R.firstLink=await R.mapComponent.getMapping(),R.mapLinkMode="linkingTo";else if(R.mapLinkMode=="linkingTo"){const S=await R.mapComponent.getMapping(),J=R.firstLink;Object.keys(S).forEach(B=>{J.hasOwnProperty(B)&&L(J[B],S[B])}),g()}},l=async()=>{const u=550,g=315;return await Pe({reshapeable:!1,resizeable:!0,region:P.rectToPoly({x:0,y:0,width:u,height:g}),width:u,height:g,targets:[{actor:"USA",id:"0",important:!0}],startupFn:S=>{S.lastFrame=0,delete S.targetData.startupFn},drawImage:!1,newPageFromRoot:!1,current_state_id:"0"},void 0,!1)},h=j(()=>({cursor:"pointer",color:{selectable:"white",linkingFrom:"green",linkingTo:"red"}[R.mapLinkMode]})),_=b(null),D=b(null),x=b(!1),E=b(null),G=b(null),C=_e({}),ye=_e([]),Re=_e([]),oe=b(null),le=b(null),ne=b({}),se=()=>{if(!oe.value)return;ye.map(g=>Ae({selected:oe.value.includes(g.value)},g)).forEach(g=>{const S=ze(Ae({},g),{renderMode:le.value});C.hasOwnProperty(g.value)&&C[g.value].init(S)})},Z=function(u){return fetch("https://api.github.com/repos/branson2015/DeRe_Apps/git/trees/main?recursive=1").then(S=>S.json()).then(S=>{const J=S.tree.map(z=>z.path).filter(z=>z.substr(0,"demos/demos/".length)==="demos/demos/").map(z=>z.substr("/demos/demos".length));D.value=J;const B=J.map(z=>fetch(`${e.modifier_directory}/${z}`).then(ce=>ce.json()));return Promise.all(B).then(z=>{_.value=z})})},re=async function(){for(;!ge("hero");)await P.sleep(1e3)};Ke(()=>{window.location.hash.substr(1)==="Edit"&&(x.value=!0),Z(e.modifier_directory).then(re),window.app=Me;const u=Xe("emitter");u.on("regionExists",g=>{y.value=g.exists,w.value=g.origin}),u.on("clickVideoCanvas",de),u.on("selectVideoCanvas",g=>{V.value=g}),u.on("changeVideoFrame",g=>Oe(...g)),u.on("addComponent",Ie),u.on("removeComponet",je),["Desktop","Mobile"].forEach(g=>Re.push({value:g.toLowerCase(),label:g})),le.value=Re[0].value,G.value.select(le.value)});const Me={editMode:x,appModes:ye,renderModes:Re,appMode:oe,renderMode:le,regionSelect:i,hintHelpState:c,dragMode:f,regionExists:y,regionOrigin:w,currVideoCanvasSelected:V,pasteBin:M,linkData:K,mapLinkData:R,appConfig:ne,loomMenuWidth:d,activeComponents:U,mapLinkStyle:h,linkVideoCanvasStyle:Ee,init:se,addMap:l,newVideoTarget:Pe,destroyVideoTarget:we,cutRegion:Le,toggleRegion:k,toggleHintHelp:X,onRenderModeChange:ue,onAppModeChange:N,saveVideoCanvasState:Ce,loadVideoCanvasState:ge,mapLinkClicked:ve,videoCanvasClicked:de,createLinkEntry:F,createLink:L,changeVideoFrame:Oe,Up:he,Down:Q,Delete:be,copy:Fe,cut:He,duplicate:pe,paste:De,addComponent:Ie,removeComponent:je,managerRef:n,appModeRef:E,renderModeRef:G,regionToggleRef:r,helpToggleRef:o,selectModeRef:a,appRefs:C,utils:P};return st("manager",Me),Me}},A=e=>(It("data-v-2522c84b"),e=e(),Tt(),e),ma={ref:"managerRef"},va={id:"loom-menu-linking",style:{position:"fixed",width:"100%",height:"80px",bottom:"0px",margin:"0 auto"}},ya=A(()=>p("span",{class:"title",style:{"grid-column":"1/-1"}},"Linking",-1)),xa={style:{"grid-column":"1"}},_a=A(()=>p("br",null,null,-1)),ba=A(()=>p("span",null,"Hints",-1)),Ca=Se(),wa=A(()=>p("br",null,null,-1)),Ma=A(()=>p("span",null,"link map",-1)),Sa=A(()=>p("br",null,null,-1)),ka=A(()=>p("span",{class:"title"},"Tools",-1)),Da=A(()=>p("span",{class:"text",style:{"margin-top":"0px"}},"Regions",-1)),$a={class:"grid-container"},Ia=A(()=>p("span",{class:"text"},"Canvas",-1)),Ta=Se(),Pa=A(()=>p("br",null,null,-1)),Oa=A(()=>p("span",{class:"text"},"Region",-1)),Ra=Se(),Aa=A(()=>p("br",null,null,-1)),Va=A(()=>p("span",{class:"text"},"Cut",-1)),Fa=Se(),La=A(()=>p("br",null,null,-1)),Ea=A(()=>p("span",{class:"text"},"Copy",-1)),Na=Se(),Ha=A(()=>p("br",null,null,-1)),ja=A(()=>p("span",{class:"text"},"Duplicate",-1)),Ba=Se(),Ua=A(()=>p("br",null,null,-1)),za=A(()=>p("span",{class:"text"},"Paste",-1)),Ya=Se(),Wa=A(()=>p("br",null,null,-1)),Xa=A(()=>p("span",{class:"text"},"Delete",-1)),Ja=Se(),qa=A(()=>p("br",null,null,-1)),Ka=A(()=>p("span",{class:"text"},"Up",-1)),Ga=Se(),Za=A(()=>p("br",null,null,-1)),Qa=A(()=>p("span",{class:"text"},"Down",-1)),eo=Se(),to=A(()=>p("br",null,null,-1)),no=A(()=>p("span",{class:"text",style:{"margin-top":"10px"}},"Region Edit",-1)),ao=A(()=>p("span",{class:"title"},"DeRe",-1)),oo=Se(" \xA0 "),so=A(()=>p("span",{class:"text",style:{"margin-top":"40px"}},"Mode",-1)),io=A(()=>p("span",{class:"text",style:{"margin-top":"40px"}},"App",-1)),ro={style:{position:"relative"}};function lo(e,t,n,a,o,c){const r=Ne("font-awesome-icon"),d=Ne("multiselect"),i=Ne("loom-instance");return H(),q("div",ma,[it(p("div",va,[p("div",null,[ya,p("div",xa,[p("input",{ref:"helpToggleRef",onClick:t[0]||(t[0]=(...f)=>e.toggleHintHelp&&e.toggleHintHelp(...f)),type:"checkbox",class:"sidebar-toggle apple-switch btn btn-default",style:{height:"20px",width:"40px !important"}},null,512),_a,ba]),p("div",{style:te([{"grid-column":"2",margin:"5px 0"},e.mapLinkStyle])},[ie(r,{icon:"map",onClick:e.mapLinkClicked},null,8,["onClick"]),Ca,wa,Ma],4),p("div",{style:te([{"grid-column":"3",margin:"5px 0"},e.linkVideoCanvasStyle])},[ie(r,{icon:"link",onClick:t[1]||(t[1]=()=>{e.linkData.linkMode=e.linkData.linkMode=="selectable"?"linkingFrom":"selectable"})}),Sa,p("span",null,ft(e.linkData.linkMode=="linkingFrom"?"linking":e.linkData.linkMode=="linkingTo"?"link to":"link"),1)],4)])],512),[[rt,e.editMode]]),it(p("div",{id:"loom-menu-tools",style:te({position:"fixed",width:e.loomMenuWidth,top:"150px",right:"0px"})},[ka,Da,p("input",{ref:"regionToggleRef",onClick:t[2]||(t[2]=(...f)=>e.toggleRegion&&e.toggleRegion(...f)),type:"checkbox",class:"sidebar-toggle apple-switch btn btn-default"},null,512),p("div",$a,[p("div",{style:{"grid-area":"newCanvas"},class:Ve((e.regionSelect,"inactiveInput"))},[Ia,Ta,Pa,ie(r,{icon:"plus-square",onClick:t[3]||(t[3]=f=>(e.regionSelect,null))})],2),p("div",{style:{"grid-area":"cutRegion"},class:Ve(e.regionSelect&&e.regionExists?"activeInput":"inactiveInput")},[Oa,Ra,Aa,ie(r,{icon:"border-none",onClick:t[4]||(t[4]=f=>e.regionSelect&&e.regionExists?e.cutRegion(f):null)})],2),p("div",{stlye:"grid-area: cut",class:Ve(e.regionSelect&&e.currVideoCanvasSelected?"activeInput":"inactiveInput")},[Va,Fa,La,ie(r,{icon:"cut",onClick:t[5]||(t[5]=f=>e.regionSelect&&e.currVideoCanvasSelected?e.cut(f):null)})],2),p("div",{stlye:"grid-area: copy",class:Ve(e.regionSelect&&e.currVideoCanvasSelected?"activeInput":"inactiveInput")},[Ea,Na,Ha,ie(r,{icon:"copy",onClick:t[6]||(t[6]=f=>e.regionSelect&&e.currVideoCanvasSelected?e.copy(f):null)})],2),p("div",{stlye:"grid-area: dup",class:Ve(e.regionSelect&&e.currVideoCanvasSelected?"activeInput":"inactiveInput")},[ja,Ba,Ua,ie(r,{icon:"clone",onClick:t[7]||(t[7]=f=>e.regionSelect&&e.currVideoCanvasSelected?e.duplicate(f):null)})],2),p("div",{style:{"grid-area":"paste"},class:Ve(e.regionSelect&&e.pasteBin?"activeInput":"inactiveInput")},[za,Ya,Wa,ie(r,{icon:"paste",onClick:t[8]||(t[8]=f=>e.regionSelect&&e.pasteBin?e.paste(f):null)})],2),p("div",{stlye:"grid-area: delete",class:Ve(e.regionSelect&&e.currVideoCanvasSelected?"activeInput":"inactiveInput")},[Xa,Ja,qa,ie(r,{icon:"trash",onClick:t[9]||(t[9]=f=>e.regionSelect&&e.currVideoCanvasSelected?e.Delete(f):null)})],2),p("div",{style:{"grid-area":"upZ"},class:Ve(e.regionSelect&&e.currVideoCanvasSelected?"activeInput":"inactiveInput")},[Ka,Ga,Za,ie(r,{icon:"arrow-up",onClick:t[10]||(t[10]=f=>e.regionSelect&&e.currVideoCanvasSelected?e.Up(f):null)})],2),p("div",{style:{"grid-area":"downZ"},class:Ve(e.regionSelect&&e.currVideoCanvasSelected?"activeInput":"inactiveInput")},[Qa,eo,to,ie(r,{icon:"arrow-down",onClick:t[11]||(t[11]=f=>e.regionSelect&&e.currVideoCanvasSelected?e.Down(f):null)})],2)]),no,p("input",{ref:"selectModeRef",onClick:t[12]||(t[12]=()=>{e.dragMode=!e.dragMode,e.dragMode||(e.regionToggleRef.checked=!0),e.regionSelect=!0}),type:"checkbox",class:"sidebar-toggle apple-switch btn btn-default"},null,512)],4),[[rt,e.editMode]]),it(p("div",{id:"loom-menu",style:te({position:"fixed",width:e.loomMenuWidth,top:"150px",left:"0px"})},[ao,p("div",null,[ie(r,{icon:"save",class:"activeInput",onClick:e.saveVideoCanvasState},null,8,["onClick"]),oo,ie(r,{icon:"file",class:"activeInput",onClick:e.loadVideoCanvasState},null,8,["onClick"])]),so,ie(d,{ref:"renderModeRef",modelValue:e.renderMode,"onUpdate:modelValue":t[13]||(t[13]=f=>e.renderMode=f),mode:"single",canDeselect:!1,canClear:!1,options:e.renderModes,onChange:e.onRenderModeChange},null,8,["modelValue","options","onChange"]),io,ie(d,{ref:"appModeRef",modelValue:e.appMode,"onUpdate:modelValue":t[14]||(t[14]=f=>e.appMode=f),mode:"tags",label:"minLabel",options:e.appModes,searchable:!0,createTag:!0,onChange:e.onAppModeChange,class:"appModeMultiselect"},null,8,["modelValue","options","onChange"])],4),[[rt,e.editMode]]),p("div",ro,[(H(!0),q(Ye,null,We(e.appModes,(f,y)=>(H(),Ge(i,{key:String(y),id:f.value,ref_for:!0,ref:w=>{w&&(e.appRefs[f.value]=w)},name:f.value,directory:f.directory,videoTargetCache:e.appConfig,regionSelect:e.regionSelect,overlay:e.hintHelpState,renderMode:e.renderMode,dragMode:e.dragMode},null,8,["id","name","directory","videoTargetCache","regionSelect","overlay","renderMode","dragMode"]))),128))])],512)}var co=ke(pa,[["render",lo],["__scopeId","data-v-2522c84b"]]);const uo={name:"MainPage",components:{UIBar:tn,loomManager:co},data:function(){return{directory:"https://raw.githubusercontent.com/branson2015/DeRe_Apps/main/apps/",modifier_directory:"https://raw.githubusercontent.com/branson2015/DeRe_Apps/main/demos/demos"}}},fo={id:"container"};function ho(e,t,n,a,o,c){const r=Ne("u-i-bar"),d=Ne("loom-manager");return H(),q("div",fo,[ie(r),ie(d,{directory:e.directory,modifier_directory:e.modifier_directory},null,8,["directory","modifier_directory"])])}var go=ke(uo,[["render",ho],["__scopeId","data-v-8fc1968e"]]);const po={components:{MainPage:go},created(){window.addEventListener("mousemove",e=>{document.body.style.cursor="default",this.emitter.emit("mousemove",e)}),window.addEventListener("mouseup",e=>{document.body.style.cursor="default",this.emitter.emit("mouseup",e)}),window.addEventListener("mousedown",e=>{this.emitter.emit("mousedown",e)})}};function mo(e,t,n,a,o,c){const r=Ne("main-page");return H(),Ge(r)}var vo=ke(po,[["render",mo]]);Pt.add(Ot,Rt,At,Vt,Ft,Lt,Et,Nt,Ht,jt,Bt,Ut,zt,Yt);const yo=e=>{const t=Jt(e);return t.emitAsync=async function(n,a){let o=this.all.get(n);if(o)for(const c of o)await c(a);if(o=this.all.get("*"),o)for(const c of o)await c(n,a)},t.emit=function(n,a){let o=[],c=this.all.get(n);return c&&(o=o.concat(c.map(r=>r(a)))),c=this.all.get("*"),c&&(o=o.concat(c.map(r=>r(a)))),o},t},vt=yo(),Qe=Wt(vo);Qe.config.globalProperties.emitter=vt;Qe.provide("emitter",vt);Qe.component("font-awesome-icon",Xt);Qe.mount("#app");
